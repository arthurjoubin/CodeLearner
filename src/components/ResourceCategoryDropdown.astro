---
import { ChevronDown, Newspaper, Command, Brain, Wrench, Tag } from 'lucide-react';

interface Props {
  currentCategory: 'news' | 'tools' | 'llms' | 'coding-bench' | 'devfinds';
}

const { currentCategory } = Astro.props;

const categories = [
  { id: 'news', name: 'News', href: '/resources/news', Icon: Newspaper },
  { id: 'tools', name: 'Tools', href: '/resources/tools', Icon: Command },
  { id: 'llms', name: 'LLMs', href: '/resources/llms', Icon: Brain },
  { id: 'coding-bench', name: 'Coding Bench', href: '/resources/coding-bench', Icon: Wrench },
  { id: 'devfinds', name: 'Deals', href: '/resources/devfinds', Icon: Tag },
];

const currentInfo = categories.find(c => c.id === currentCategory);
const CurrentIcon = currentInfo?.Icon || Newspaper;
---

<div class="relative category-dd">
  <div class="dd-overlay fixed inset-0 z-40" onclick="this.closest('.category-dd').classList.remove('dd-open')"></div>
  <button
    type="button"
    onclick="event.stopPropagation(); document.querySelectorAll('.resource-dd.dd-open, .category-dd.dd-open').forEach(el => el !== this.parentElement && el.classList.remove('dd-open')); this.parentElement.classList.toggle('dd-open')"
    class="flex items-center gap-1.5 sm:gap-2 px-2.5 sm:px-3 py-2 bg-gray-900 text-white border border-gray-900 rounded-lg hover:bg-gray-800 transition-colors text-xs sm:text-sm font-bold cursor-pointer"
  >
    <CurrentIcon className="w-3.5 h-3.5 sm:w-4 sm:h-4" />
    <span class="hidden xs:inline">{currentInfo?.name}</span>
    <ChevronDown className="w-3.5 h-3.5 sm:w-4 sm:h-4 transition-transform dd-chevron" />
  </button>

  <div class="dd-menu absolute right-0 top-full mt-2 w-48 bg-white border-2 border-gray-300 rounded-lg z-50 overflow-hidden shadow-xl">
    <div class="flex items-center justify-between px-3 py-2.5 border-b border-gray-200 bg-gray-50">
      <span class="font-bold uppercase text-[10px] text-gray-500">Resources</span>
      <button type="button" onclick="this.closest('.category-dd').classList.remove('dd-open')" class="sm:hidden p-1 hover:bg-gray-200 rounded transition-colors">
        <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    {categories.map(({ id, name, href, Icon }) => (
      <a
        href={href}
        class={`flex items-center gap-3 px-3 py-3 sm:py-2.5 transition-colors border-b border-gray-100 last:border-b-0 ${
          id === currentCategory
            ? 'bg-primary-50 text-primary-700'
            : 'hover:bg-gray-50 active:bg-gray-100 text-gray-900'
        }`}
      >
        <Icon className={`w-4 h-4 flex-shrink-0 ${id === currentCategory ? 'text-primary-600' : 'text-gray-500'}`} />
        <span class="text-sm font-bold flex-1">{name}</span>
        {id === currentCategory && (
          <div class="w-2 h-2 bg-primary-500 rounded-full flex-shrink-0"></div>
        )}
      </a>
    ))}
  </div>
</div>

<style is:global>
  .category-dd .dd-overlay {
    display: none;
  }
  .category-dd .dd-menu {
    display: none;
  }
  .category-dd.dd-open .dd-overlay {
    display: block;
  }
  .category-dd.dd-open .dd-menu {
    display: block;
  }
  .category-dd.dd-open .dd-chevron {
    transform: rotate(180deg);
  }
</style>
