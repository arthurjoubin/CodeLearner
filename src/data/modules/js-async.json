{
  "module": {
    "id": "js-async",
    "courseId": "javascript-core",
    "title": "Async JavaScript",
    "description": "Handle asynchronous operations with Promises and async/await",
    "icon": "Zap",
    "requiredXp": 400,
    "color": "from-amber-400 to-amber-600"
  },
  "lessons": [
    {
      "id": "js-promises",
      "moduleId": "js-async",
      "title": "Promises",
      "order": 1,
      "difficulty": "intermediate",
      "content": "# Essential to know\n- Promises represent future values\n- States: pending, fulfilled, rejected\n- `.then()` for success, `.catch()` for errors\n- `Promise.all()` runs multiple in parallel\n\n---\n\n# Promises",
      "codeExample": "const fetchUser = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve({ name: \"Alice\", age: 25 });\n  }, 1000);\n});\n\nfetchUser\n  .then(user => console.log(user.name))\n  .catch(err => console.error(err));"
    },
    {
      "id": "js-async-await",
      "moduleId": "js-async",
      "title": "Async / Await",
      "order": 2,
      "difficulty": "intermediate",
      "content": "# Essential to know\n- `async` makes a function return a Promise\n- `await` pauses until a Promise resolves\n- Use `try/catch` for error handling\n- Cleaner than `.then()` chains\n\n---\n\n# Async / Await",
      "codeExample": "async function getUser() {\n  try {\n    const response = await fetch('/api/user');\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Failed:', error);\n  }\n}"
    },
    {
      "id": "js-fetch-api",
      "moduleId": "js-async",
      "title": "The Fetch API",
      "order": 3,
      "difficulty": "intermediate",
      "content": "# Essential to know\n- `fetch()` makes HTTP requests\n- Returns a Promise\n- `response.json()` parses JSON body\n- Can set method, headers, body for POST requests\n\n---\n\n# The Fetch API",
      "codeExample": "// GET request\nconst res = await fetch('https://api.example.com/users');\nconst users = await res.json();\n\n// POST request\nconst res2 = await fetch('https://api.example.com/users', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({ name: 'Alice' })\n});"
    },
    {
      "id": "js-error-handling",
      "moduleId": "js-async",
      "title": "Error Handling",
      "order": 4,
      "difficulty": "intermediate",
      "content": "# Essential to know\n- `try/catch` catches synchronous and async errors\n- `finally` runs regardless of outcome\n- Always handle fetch errors (network + HTTP status)\n- Custom error messages help debugging\n\n---\n\n# Error Handling",
      "codeExample": "async function safeFetch(url) {\n  try {\n    const res = await fetch(url);\n    if (!res.ok) {\n      throw new Error(`HTTP ${res.status}`);\n    }\n    return await res.json();\n  } catch (error) {\n    console.error('Fetch failed:', error.message);\n    return null;\n  } finally {\n    console.log('Request completed');\n  }\n}"
    }
  ],
  "exercises": [
    {
      "id": "js-async-ex-1",
      "lessonId": "js-promises",
      "moduleId": "js-async",
      "title": "Promises Quiz",
      "difficulty": "easy",
      "type": "quiz",
      "questions": [
        {
          "question": "What happens if you don't add .catch() to a Promise?",
          "options": [
            "The Promise won't run",
            "Errors will crash the app",
            "Errors will be silently ignored (bad!)",
            "JavaScript automatically handles it"
          ],
          "correctAnswer": 2,
          "explanation": "Unhandled Promise rejections are silently ignored (or show warnings). Always add .catch() or use try/catch!"
        },
        {
          "question": "What does Promise.all() do?",
          "options": [
            "Runs Promises one after another",
            "Runs Promises in parallel and waits for all to finish",
            "Runs only the fastest Promise",
            "Cancels all Promises"
          ],
          "correctAnswer": 1,
          "explanation": "Promise.all() runs all Promises in parallel and resolves when ALL finish (or rejects if ANY fails)."
        }
      ]
    },
    {
      "id": "js-async-ex-2",
      "lessonId": "js-async-await",
      "moduleId": "js-async",
      "title": "Fix the Async Function",
      "difficulty": "medium",
      "type": "code",
      "description": "AI generated this async function but forgot error handling. Fix it!",
      "instructions": "The function should:\n1. Fetch data from the API\n2. Parse the JSON response\n3. Return the data\n4. Handle errors with try/catch\n5. Return null if it fails\n\nCurrently it has no error handling - add it!",
      "starterCode": "async function getUserData(userId) {\n  const response = await fetch(`/api/users/${userId}`);\n  const data = await response.json();\n  return data;\n}",
      "solution": "async function getUserData(userId) {\n  try {\n    const response = await fetch(`/api/users/${userId}`);\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Failed to fetch user:', error);\n    return null;\n  }\n}",
      "hints": [
        "Wrap the fetch in try/catch",
        "Check response.ok before parsing JSON",
        "Throw an error if response is not OK",
        "Return null in the catch block"
      ],
      "validationPrompt": "Check if the code: 1) Has try/catch wrapping the fetch 2) Checks response.ok and throws error if not OK 3) Handles errors in catch block 4) Returns null on error 5) Logs the error"
    },
    {
      "id": "js-async-ex-3",
      "lessonId": "js-fetch-api",
      "moduleId": "js-async",
      "title": "Make a POST Request",
      "difficulty": "medium",
      "type": "code",
      "description": "Write a function to create a new user via POST request.",
      "instructions": "Create a createUser(name, email) function that:\n1. Makes a POST request to '/api/users'\n2. Sends JSON body with name and email\n3. Sets Content-Type header to 'application/json'\n4. Returns the created user data\n5. Uses async/await",
      "starterCode": "async function createUser(name, email) {\n  // Your code here\n}",
      "solution": "async function createUser(name, email) {\n  const response = await fetch('/api/users', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ name, email })\n  });\n  \n  const data = await response.json();\n  return data;\n}",
      "hints": [
        "Use fetch() with options object as second parameter",
        "Set method: 'POST' in options",
        "Headers need Content-Type: application/json",
        "Body must be JSON.stringify() of the object",
        "Don't forget to await response.json()"
      ],
      "validationPrompt": "Check if the code: 1) Uses fetch with POST method 2) Sets Content-Type header 3) Sends JSON body with name and email using JSON.stringify 4) Awaits response and parses JSON 5) Returns the data"
    },
    {
      "id": "js-async-ex-4",
      "lessonId": "js-error-handling",
      "moduleId": "js-async",
      "title": "Debug the Fetch Error",
      "difficulty": "medium",
      "type": "code",
      "description": "This code doesn't handle HTTP errors correctly. Fix it!",
      "instructions": "The code below doesn't check if the response is successful.\nAdd proper error handling:\n1. Check response.ok before parsing\n2. Throw descriptive error if status is not 2xx\n3. Catch and log errors properly",
      "starterCode": "async function fetchPosts() {\n  try {\n    const response = await fetch('/api/posts');\n    const posts = await response.json();\n    return posts;\n  } catch (error) {\n    console.log('Error');\n  }\n}",
      "solution": "async function fetchPosts() {\n  try {\n    const response = await fetch('/api/posts');\n    if (!response.ok) {\n      throw new Error(`Failed to fetch: ${response.status} ${response.statusText}`);\n    }\n    const posts = await response.json();\n    return posts;\n  } catch (error) {\n    console.error('Fetch failed:', error.message);\n    throw error;\n  }\n}",
      "hints": [
        "Check response.ok (true for status 200-299)",
        "If not OK, throw new Error with status code",
        "Log full error.message, not just 'Error'",
        "Consider re-throwing the error so caller knows it failed"
      ],
      "validationPrompt": "Check if the code: 1) Checks response.ok before parsing JSON 2) Throws error with status code if not OK 3) Logs descriptive error message in catch 4) Either returns null or re-throws the error"
    }
  ]
}
