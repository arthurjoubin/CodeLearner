{
  "module": {
    "id": "nodejs-npm",
    "title": "Node.js: npm and Ecosystem",
    "description": "Master npm: scripts, npx, workspaces, publishing, and advanced dependency management",
    "icon": "Package",
    "requiredXp": 300,
    "color": "from-red-500 to-pink-600",
    "courseId": "node-express"
  },
  "lessons": [
    {
      "id": "npm-scripts",
      "moduleId": "nodejs-npm",
      "title": "Custom npm Scripts",
      "order": 1,
      "difficulty": "beginner",
      "content": "# Essential to know\n- npm scripts automate common tasks\n- Defined in `package.json` under `scripts`\n- `npm run script-name` to execute\n- Special scripts: start, test, install, postinstall\n\n---\n\n# Automating with npm Scripts\n\nnpm scripts allow you to define shortcut commands for your project. It's the equivalent of Makefiles or shell scripts, but integrated into npm.\n\n## Basic Scripts\n\n```json\n{\n  \"scripts\": {\n    \"start\": \"node src/index.js\",\n    \"dev\": \"node --watch src/index.js\",\n    \"test\": \"node --test\",\n    \"build\": \"echo 'Building...'\"\n  }\n}\n```\n\nExecution:\n```bash\nnpm start        # Works without 'run'\nnpm test         # Same\nnpm run dev      # Requires 'run' for custom scripts\nnpm run build\n```\n\n## Advanced Scripts\n\n```json\n{\n  \"scripts\": {\n    \"start\": \"node dist/index.js\",\n    \"dev\": \"nodemon src/index.js\",\n    \"build\": \"npm run clean \u0026\u0026 npm run compile\",\n    \"clean\": \"rm -rf dist\",\n    \"compile\": \"tsc\",\n    \"test\": \"jest\",\n    \"test:watch\": \"jest --watch\",\n    \"test:coverage\": \"jest --coverage\",\n    \"lint\": \"eslint src/\",\n    \"lint:fix\": \"eslint src/ --fix\",\n    \"format\": \"prettier --write src/\",\n    \"db:migrate\": \"prisma migrate dev\",\n    \"db:seed\": \"node scripts/seed.js\"\n  }\n}\n```\n\n## Pre/Post Scripts\n\nnpm automatically executes scripts before/after:\n\n```json\n{\n  \"scripts\": {\n    \"prestart\": \"npm run build\",\n    \"start\": \"node dist/index.js\",\n    \"poststart\": \"echo 'Server started!'\"\n  }\n}\n```\n\n```bash\nnpm run start\n# 1. Executes prestart\n# 2. Executes start\n# 3. Executes poststart\n```\n\nOther special scripts:\n- `preinstall` / `postinstall`: before/after `npm install`\n- `prepare`: executed after install and before publish\n- `prepublishOnly`: before npm publish\n\n## Passing Arguments\n\n```json\n{\n  \"scripts\": {\n    \"test\": \"jest\",\n    \"test:file\": \"jest --testPathPattern\"\n  }\n}\n```\n\n```bash\n# Pass arguments with --\nnpm run test -- --verbose\nnpm run test:file -- user.test.js\n\n# Direct for some scripts\nnpm start -- --port 8080\n```\n\n## Environment Variables\n\n```json\n{\n  \"scripts\": {\n    \"dev\": \"NODE_ENV=development node src/index.js\",\n    \"prod\": \"NODE_ENV=production node src/index.js\",\n    \"debug\": \"DEBUG=* node src/index.js\"\n  }\n}\n```\n\nOn Windows, use `cross-env`:\n```bash\nnpm install --save-dev cross-env\n```\n\n```json\n{\n  \"scripts\": {\n    \"dev\": \"cross-env NODE_ENV=development node src/index.js\"\n  }\n}\n```\n\n## npm-run-all (Parallel/Sequential)\n\n```bash\nnpm install --save-dev npm-run-all\n```\n\n```json\n{\n  \"scripts\": {\n    \"start:api\": \"node api.js\",\n    \"start:web\": \"node web.js\",\n    \"start:all\": \"npm-run-all --parallel start:api start:web\",\n    \"build:all\": \"npm-run-all --sequential build:client build:server\"\n  }\n}\n```\n\n## Script Lifecycle\n\n```json\n{\n  \"scripts\": {\n    \"prepare\": \"husky install\",           // After npm install\n    \"prepublishOnly\": \"npm test \u0026\u0026 npm run build\",\n    \"version\": \"npm run changelog\",       // After version bump\n    \"postversion\": \"git push \u0026\u0026 git push --tags\"\n  }\n}\n```\n\n## Complete Example\n\n```json\n{\n  \"name\": \"my-app\",\n  \"version\": \"1.0.0\",\n  \"scripts\": {\n    \"prestart\": \"npm run build\",\n    \"start\": \"node dist/index.js\",\n    \"dev\": \"nodemon src/index.js\",\n    \"build\": \"npm run clean \u0026\u0026 tsc\",\n    \"clean\": \"rimraf dist\",\n    \"test\": \"jest\",\n    \"test:watch\": \"jest --watch\",\n    \"test:coverage\": \"jest --coverage --coverageReporters=text-lcov | coveralls\",\n    \"lint\": \"eslint src/ --ext .js,.ts\",\n    \"lint:fix\": \"eslint src/ --ext .js,.ts --fix\",\n    \"format\": \"prettier --write 'src/**/*.{js,ts,json}'\",\n    \"format:check\": \"prettier --check 'src/**/*.{js,ts,json}'\",\n    \"typecheck\": \"tsc --noEmit\",\n    \"validate\": \"npm run typecheck \u0026\u0026 npm run lint \u0026\u0026 npm run test\",\n    \"prepare\": \"husky install\",\n    \"prepublishOnly\": \"npm run validate \u0026\u0026 npm run build\"\n  }\n}\n```\n\n## Best Practices\n\n1. **Use standard names**: start, test, build\n2. **Group related scripts**: `test:unit`, `test:e2e`\n3. **Document complex scripts**: Add comments in README\n4. **Avoid long scripts**: Use separate files in `scripts/` folder\n5. **Make scripts cross-platform**: Use `cross-env`, `rimraf`"
    },
    {
      "id": "npm-npx",
      "moduleId": "nodejs-npm",
      "title": "npx: Execute Packages",
      "order": 2,
      "difficulty": "intermediate",
      "content": "# Essential to know\n- `npx` executes packages without installing them globally\n- Uses local version if available, otherwise downloads\n- Perfect for CLI tools (create-react-app, prisma)\n- Avoids global version conflicts\n\n---\n\n# Why Use npx?\n\nBefore npx, to use a CLI tool like `create-react-app`, you had to:\n1. Install it globally: `npm install -g create-react-app`\n2. Use the command\n\nProblems:\n- Outdated global version?\n- Conflicts between projects requiring different versions\n- Global pollution of your system\n\n## npx to the Rescue\n\nnpx solves these problems by:\n1. Looking for the binary in `node_modules/.bin` (local)\n2. If not found, downloading and executing temporarily\n3. Cleaning up after use\n\n## Common Use Cases\n\n### Creating a Project\n```bash\n# React\nnpx create-react-app my-app\n\n# Next.js\nnpx create-next-app@latest my-app\n\n# Vite\nnpx create-vite my-app --template react\n\n# Express generator\nnpx express-generator my-api\n```\n\n### Development Tools\n```bash\n# Run ESLint without installing globally\nnpx eslint src/\n\n# Format with Prettier\nnpx prettier --write .\n\n# Run Prisma migrations\nnpx prisma migrate dev\n\n# Compile TypeScript\nnpx tsc --init\nnpx tsc\n```\n\n### Testing a Package Quickly\n```bash\n# Test lodash without installing\nnpx -p lodash node -e \\\"const _ = require('lodash'); console.log(_.chunk([1,2,3,4], 2));\\\"\n\n# Launch a temporary HTTP server\nnpx http-server ./dist -p 8080\n```\n\n### Force a Specific Version\n\n```bash\n# Always use latest version\nnpx create-react-app@latest my-app\n\n# Specific version\nnpx create-react-app@4.0.0 my-app\n```\n\n### Execute from GitHub\n\n```bash\n# Execute a gist\nnpx https://gist.github.com/user/gist-id\n\n# Execute from a repo\nnpx github:user/repo\n```\n\n## Package Not Found?\n\nIf npx doesn't find a package and you have `package.json`:\n\n```bash\n# Option 1: Install locally first\nnpm install --save-dev eslint\nnpx eslint src/\n\n# Option 2: Execute directly\nnpx -p eslint eslint src/\n\n# Option 3: Use npm exec (npm 7+)\nnpm exec eslint src/\n```\n\n## npx vs npm exec\n\n```bash\n# These are equivalent (npm 7+)\nnpx eslint src/\nnpm exec eslint src/\n\n# npm exec with flags\nnpm exec -- eslint src/ --fix\n```\n\n## Using npx in npm Scripts\n\n```json\n{\n  \"scripts\": {\n    \"lint\": \"npx eslint src/\",\n    \"format\": \"npx prettier --write .\",\n    \"migrate\": \"npx prisma migrate dev\"\n  }\n}\n```\n\n## Advanced npx Options\n\n```bash\n# Install package if not found (--yes or -y)\nnpx --yes create-react-app my-app\n\n# Ignore existing cached version (--ignore-existing)\nnpx --ignore-existing create-react-app my-app\n\n# Show what would be executed without running (--dry-run)\nnpx --dry-run create-react-app my-app\n\n# Use specific Node version (--node-arg)\nnpx --node-arg=--experimental-vm-modules jest\n```\n\n## Package Binaries\n\nWhen you install a package with a `bin` field in `package.json`:\n\n```json\n{\n  \"name\": \"my-cli\",\n  \"bin\": {\n    \"my-cli\": \"./bin/cli.js\"\n  }\n}\n```\n\nnpx can execute it:\n```bash\nnpx my-cli\n```\n\n## Practical Example Workflow\n\n```bash\n# 1. Create a new Node.js project\nmkdir my-project \u0026\u0026 cd my-project\n\n# 2. Initialize with interactive prompts\nnpx --yes create-esm my-project\n\n# 3. Add TypeScript support\nnpx tsc --init\n\n# 4. Setup ESLint\nnpx eslint --init\n\n# 5. Format all files\nnpx prettier --write .\n\n# 6. Run tests\nnpx jest\n```"
    },
    {
      "id": "npm-semver",
      "moduleId": "nodejs-npm",
      "title": "Semantic Versioning (semver)",
      "order": 3,
      "difficulty": "intermediate",
      "content": "# Essential to know\n- Version = MAJOR.MINOR.PATCH (e.g.: 2.4.1)\n- MAJOR: Breaking changes (incompatible)\n- MINOR: New features (compatible)\n- PATCH: Bug fixes\n- ^ and ~ control automatic updates\n\n---\n\n# Understanding Semantic Versioning\n\nSemver is a standard for numbering software versions. It helps understand the impact of an update.\n\n## Format: MAJOR.MINOR.PATCH\n\n```\n2.4.1\n│ │ │\n│ │ └─ PATCH: Bug fixes (1 → 2)\n│ └── MINOR: New features (4 → 5)\n└── MAJOR: Breaking changes (2 → 3)\n```\n\n### When to Increment?\n\n- **MAJOR**: You break compatibility (API changes)\n  - Ex: Rename a function, change parameters\n  - Users must modify their code\n\n- **MINOR**: New features, backward compatible\n  - Ex: Add a new function\n  - Users can upgrade without risk\n\n- **PATCH**: Bug fixes, backward compatible\n  - Ex: Fix an error, performance improvement\n  - Upgrade always safe\n\n## Range Operators (Version Selectors)\n\n### Exact\n```json\n{\n  \"express\": \"4.18.0\"\n}\n```\nInstalls exactly this version. Never auto-updates.\n\n### Caret ^ (Recommended)\n```json\n{\n  \"express\": \"^4.18.0\"\n}\n```\nAccepts: 4.18.0 and higher, but \u003c 5.0.0\n- ✅ PATCH and MINOR updates\n- ❌ MAJOR updates (breaking changes)\n\n### Tilde ~\n```json\n{\n  \"express\": \"~4.18.0\"\n}\n```\nAccepts: 4.18.0 and higher, but \u003c 4.19.0\n- ✅ PATCH updates only\n- ❌ MINOR and MAJOR\n\n### Comparators\n```json\n{\n  \"pkg1\": \">1.0.0\",           // Greater than 1.0.0\n  \"pkg2\": \">=1.0.0\",          // Greater than or equal\n  \"pkg3\": \"<2.0.0\",           // Less than 2.0.0\n  \"pkg4\": \">=1.0.0 <2.0.0\",  // Range\n  \"pkg5\": \"1.0.0 || 2.0.0\"   // One or the other\n}\n```\n\n### Wildcard *\n```json\n{\n  \"express\": \"*\"  // Latest version (DANGEROUS!)\n}\n```\n⚠️ Never use in production!\n\n## Version Resolution\n\n```bash\n# What versions match?\nnpm view express versions --json | grep \"^4\\.17\"\n\n# Check outdated packages\nnpm outdated\n\n# Update respecting semver\nnpm update\n\n# Update to latest (ignore semver)\nnpm install express@latest\n```\n\n## package-lock.json\n\nThis file locks exact versions:\n\n```json\n{\n  \"name\": \"express\",\n  \"version\": \"4.18.2\",\n  \"resolved\": \"https://registry.npmjs.org/express/-/express-4.18.2.tgz\",\n  \"integrity\": \"sha512-...\"\n}\n```\n\n**Always commit package-lock.json** for reproducible installs.\n\n## Update Strategies\n\n### Conservative (production)\n```json\n{\n  \"dependencies\": {\n    \"express\": \"~4.18.0\",      // Only patches\n    \"lodash\": \"4.17.21\"         // Exact\n  }\n}\n```\n\n### Balanced (recommended)\n```json\n{\n  \"dependencies\": {\n    \"express\": \"^4.18.0\",      // Patches + minors\n    \"lodash\": \"^4.17.21\"\n  }\n}\n```\n\n### Latest (development)\n```json\n{\n  \"devDependencies\": {\n    \"jest\": \"^29.0.0\",\n    \"eslint\": \"^8.0.0\"\n  }\n}\n```\n\n## Breaking Changes Detection\n\n```bash\n# Check for breaking changes before updating\nnpm install express@latest --dry-run\n\n# Review changelog\nnpm info express\n\n# Use npm-check-updates (ncu)\nnpm install -g npm-check-updates\nncu  # Shows updatable packages\nncu -u  # Updates package.json\n```\n\n## Pre-release Versions\n\n```\n1.0.0-alpha.1    // Alpha\n1.0.0-beta.2     // Beta\n1.0.0-rc.1       // Release Candidate\n```\n\n```json\n{\n  \"dependencies\": {\n    \"package\": \"^1.0.0-beta.2\"\n  }\n}\n```\n\n## Best Practices\n\n1. **Start with ^**: Allows non-breaking updates\n2. **Pin critical deps**: For security-sensitive packages\n3. **Review changelogs**: Before MAJOR updates\n4. **Test after updates**: Even minor updates can have bugs\n5. **Use lock file**: Ensures reproducible builds"
    },
    {
      "id": "npm-workspaces",
      "moduleId": "nodejs-npm",
      "title": "Workspaces: Monorepos",
      "order": 4,
      "difficulty": "advanced",
      "content": "# Essential to know\n- Workspaces manage multiple packages in a single repo (monorepo)\n- Shares common dependencies (node_modules at root)\n- Simplified installation and publishing\n- Alternatives: Lerna, Nx, Turborepo\n\n---\n\n# Managing a Monorepo with npm Workspaces\n\nA monorepo contains multiple packages/packages in a single repository. Common for:\n- Sharing code between frontend and backend\n- Managing a library with its satellite packages\n- Developing an ecosystem of plugins/tools\n\n## Workspace Structure\n\n```\nmonorepo/\n├── package.json          # Root with workspaces config\n├── node_modules/         # Shared dependencies\n├── packages/\n│   ├── shared/          # Shared code\n│   │   ├── package.json\n│   │   └── src/\n│   ├── api/             # Express backend\n│   │   ├── package.json\n│   │   └── src/\n│   └── web/             # React frontend\n│       ├── package.json\n│       └── src/\n└── apps/\n    └── admin/           # Admin application\n        └── package.json\n```\n\n## Configuration\n\n```json\n// package.json (root)\n{\n  \"name\": \"monorepo\",\n  \"private\": true,  // Important: prevents accidental publishing\n  \"workspaces\": [\n    \"packages/*\",\n    \"apps/*\"\n  ],\n  \"scripts\": {\n    \"build\": \"npm run build --workspaces\",\n    \"test\": \"npm run test --workspaces\",\n    \"dev:api\": \"npm run dev -w @monorepo/api\",\n    \"dev:web\": \"npm run dev -w @monorepo/web\"\n  }\n}\n```\n\n## Package Configuration\n\n```json\n// packages/shared/package.json\n{\n  \"name\": \"@monorepo/shared\",\n  \"version\": \"1.0.0\",\n  \"main\": \"dist/index.js\",\n  \"scripts\": {\n    \"build\": \"tsc\",\n    \"test\": \"jest\"\n  }\n}\n\n// packages/api/package.json\n{\n  \"name\": \"@monorepo/api\",\n  \"dependencies\": {\n    \"@monorepo/shared\": \"^1.0.0\",\n    \"express\": \"^4.18.0\"\n  }\n}\n```\n\n## Workspace Commands\n\n```bash\n# Install all dependencies (from root)\nnpm install\n\n# Add dependency to specific workspace\nnpm install lodash -w @monorepo/api\nnpm install -D jest -w @monorepo/shared\n\n# Add dependency to all workspaces\nnpm install typescript -ws\n\n# Run script in specific workspace\nnpm run build -w @monorepo/shared\n\n# Run script in all workspaces\nnpm run test --workspaces\n\n# Run with if-present (no error if script missing)\nnpm run build --workspaces --if-present\n```\n\n## Cross-Package Dependencies\n\n```json\n// packages/api/package.json\n{\n  \"dependencies\": {\n    \"@monorepo/shared\": \"^1.0.0\",\n    \"express\": \"^4.18.0\"\n  }\n}\n\n// packages/web/package.json\n{\n  \"dependencies\": {\n    \"@monorepo/shared\": \"^1.0.0\",\n    \"react\": \"^18.0.0\"\n  }\n}\n```\n\nnpm automatically links local packages:\n```\nmonorepo/\n├── node_modules/\n│   ├── @monorepo/shared → ../../packages/shared  # Symlink\n│   ├── @monorepo/api → ../../packages/api\n│   └── express/\n```\n\n## Scripts and Orchestration\n\n### Root package.json\n```json\n{\n  \"scripts\": {\n    \"build\": \"npm run build --workspaces --if-present\",\n    \"test\": \"npm run test --workspaces --if-present\",\n    \"clean\": \"npm run clean --workspaces --if-present\",\n    \"dev\": \"npm-run-all --parallel dev:api dev:web\",\n    \"dev:api\": \"npm run dev -w @monorepo/api\",\n    \"dev:web\": \"npm run dev -w @monorepo/web\",\n    \"lint\": \"eslint packages/*/src\"\n  }\n}\n```\n\n## Workspace-Only Dependencies\n\n```json\n// Some packages only needed at root\n{\n  \"devDependencies\": {\n    \"@types/node\": \"^20.0.0\",\n    \"typescript\": \"^5.0.0\",\n    \"jest\": \"^29.0.0\",\n    \"lerna\": \"^7.0.0\"  // If using Lerna with npm workspaces\n  }\n}\n```\n\n## Publishing Workspaces\n\n### Manual Publishing\n```bash\n# Version bump\nnpm version patch -w @monorepo/shared\n\n# Publish\nnpm publish -w @monorepo/shared --access public\n```\n\n### With Changesets (recommended)\n```bash\nnpm install --save-dev @changesets/cli\nnpx changeset init\n```\n\n```json\n{\n  \"scripts\": {\n    \"changeset\": \"changeset\",\n    \"version-packages\": \"changeset version\",\n    \"release\": \"npm run build && changeset publish\"\n  }\n}\n```\n\n## Comparison with Alternatives\n\n| Tool | Best For | Complexity |\n|------|----------|------------|\n| npm workspaces | Simple monorepos | Low |\n| Lerna | Publishing, versioning | Medium |\n| Nx | Enterprise, caching | High |\n| Turborepo | Build pipelines | Medium |\n| pnpm | Disk efficiency | Low |\n| Yarn | Mature ecosystem | Low |\n\n## When to Use npm Workspaces\n\n✅ **Use when:**\n- 2-10 related packages\n- Shared dependencies\n- Simple build process\n- Team familiar with npm\n\n❌ **Consider alternatives when:**\n- Complex build pipelines\n- Heavy caching needed\n- 20+ packages\n- Need advanced task orchestration\n\n## Complete Example\n\n```bash\n# Create monorepo\nmkdir monorepo \u0026\u0026 cd monorepo\n\n# Initialize root\nnpm init -y\n```\n\n```json\n{\n  \"name\": \"my-monorepo\",\n  \"private\": true,\n  \"workspaces\": [\"packages/*\"],\n  \"scripts\": {\n    \"build\": \"npm run build --workspaces\",\n    \"test\": \"npm run test --workspaces\",\n    \"clean\": \"rm -rf packages/*/node_modules packages/*/dist\"\n  }\n}\n```\n\n```bash\n# Create packages\nmkdir -p packages/{shared,api,web}\ncd packages/shared \u0026\u0026 npm init -y --scope=@myorg\ncd ../api \u0026\u0026 npm init -y --scope=@myorg\ncd ../web \u0026\u0026 npm init -y --scope=@myorg\n\n# Install dependencies\nnpm install\n\n# Add cross-dependencies\nnpm install @myorg/shared -w @myorg/api\nnpm install @myorg/shared -w @myorg/web\n```"
    }
  ],
  "exercises": []
}
