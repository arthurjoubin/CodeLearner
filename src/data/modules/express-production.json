{"module":{"id":"express-production","title":"Express: Production and Deployment","description":"Prepare your Express application for production: security, performance, monitoring and deployment","icon":"Rocket","requiredXp":800,"color":"from-purple-500 to-pink-600","courseId":"deployment"},"lessons":[{"id":"production-security","moduleId":"express-production","title":"Security in Production","order":1,"difficulty":"intermediate","content":"# Essential to know\\n- HTTPS mandatory in production\\n- Never expose sensitive information\\n- Protect against common attacks (XSS, CSRF, injections)\\n- Use security headers (helmet)\\n- Validate ALL user input\\n\\n---\\n\\n# Production security checklist\\n\\n## 1. Security Headers (Helmet)\\n\\n```javascript\\nimport helmet from 'helmet';\\n\\napp.use(helmet({\\n  contentSecurityPolicy: {\\n    directives: {\\n      defaultSrc: [\\\"'self'\\\"],\\n      styleSrc: [\\\"'self'\\\", \\\"'unsafe-inline'\\\"],\\n      scriptSrc: [\\\"'self'\\\"],\\n      imgSrc: [\\\"'self'\\\", 'data:', 'https:']\\n    }\\n  },\\n  hsts: {\\n    maxAge: 31536000,\\n    includeSubDomains: true,\\n    preload: true\\n  }\\n}));\\n```\\n\\n## 2. Secure CORS\\n\\n```javascript\\nimport cors from 'cors';\\n\\n// Whitelist of allowed origins\\nconst whitelist = ['https://my-app.com', 'https://admin.my-app.com'];\\n\\nconst corsOptions = {\\n  origin: (origin, callback) => {\\n    if (whitelist.includes(origin) || !origin) {\\n      callback(null, true);\\n    } else {\\n      callback(new Error('Not allowed by CORS'));\\n    }\\n  },\\n  credentials: true,\\n  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH'],\\n  allowedHeaders: ['Content-Type', 'Authorization']\\n};\\n\\napp.use(cors(corsOptions));\\n```\\n\\n## 3. Rate Limiting\\n\\n```javascript\\nimport rateLimit from 'express-rate-limit';\\n\\n// General limit\\nconst generalLimiter = rateLimit({\\n  windowMs: 15 * 60 * 1000,  // 15 minutes\\n  max: 100,\\n  message: 'Too many requests from this IP'\\n});\\napp.use(generalLimiter);\\n\\n// Strict limit for auth\\nconst authLimiter = rateLimit({\\n  windowMs: 15 * 60 * 1000,\\n  max: 5,\\n  skipSuccessfulRequests: true\\n});\\napp.use('/auth/', authLimiter);\\n```\\n\\n## 4. XSS Protection\\n\\n```javascript\\n// Sanitize inputs\\nimport mongoSanitize from 'express-mongo-sanitize';\\nimport xss from 'xss-clean';\\n\\n// Prevent NoSQL injections\\napp.use(mongoSanitize());\\n\\n// Clean en..."},{"id":"production-performance","moduleId":"express-production","title":"Performance and Optimization","order":2,"difficulty":"intermediate","content":"# Essential to know\\n- Use gzip compression\\n- Cache responses\\n- Use CDN for static assets\\n- Optimize DB queries (indexes, selective)\\n- Monitor performance\\n\\n---\\n\\n# Optimizing Performance\\n\\n## 1. Compression\\n\\n```javascript\\nimport compression from 'compression';\\n\\n// Compress all responses\\napp.use(compression());\\n\\n// Configure threshold\\napp.use(compression({\\n  threshold: 1024,  // Compress if > 1KB\\n  filter: (req, res) => {\\n    if (req.headers['x-no-compression']) {\\n      return false;\\n    }\\n    return compression.filter(req, res);\\n  }\\n}));\\n```\\n\\n## 2. HTTP Cache\\n\\n```javascript\\n// Cache middleware\\nconst cacheMiddleware = (duration = 300) => {\\n  return (req, res, next) => {\\n    res.set('Cache-Control', `public, max-age=${duration}`);\\n    next();\\n  };\\n};\\n\\n// Routes with cache\\napp.get('/api/public-data', cacheMiddleware(3600), handler);\\n\\n// No cache for sensitive data\\napp.get('/api/user/profile', (req, res, next) => {\\n  res.set('Cache-Control', 'no-store');\\n  next();\\n}, handler);\\n```\\n\\n## 3. Limiting DB Queries\\n\\n```javascript\\n// Mandatory pagination\\napp.get('/api/users', async (req, res) => {\\n  const page = parseInt(req.query.page) || 1;\\n  const limit = Math.min(parseInt(req.query.limit) || 20, 100);  // Max 100\\n  const skip = (page - 1) * limit;\\n  \\n  const users = await User\\n    .find()\\n    .select('-password -secretField')  // Exclude sensitive fields\\n    .limit(limit)\\n    .skip(skip)\\n    .lean();  // Plain JS objects (faster)\\n  \\n  res.json(users);\\n});\\n```\\n\\n## 4. DB Connection Pooling\\n\\n```javascript\\n// MongoDB\\nconst conn = await mongoose.connect(process.env.DATABASE_URL, {\\n  maxPoolSize: 10,  // Concurrent connections\\n  minPoolSize: 5,   // Minimum maintained connections\\n  serverSelectionTimeoutMS: 5000,\\n  socketTimeoutMS: 45000,\\n});\\n\\n// PostgreSQL with pg\\nconst pool = new Pool({\\n  c..."},{"id":"production-deployment","moduleId":"express-production","title":"Deployment and Docker","order":3,"difficulty":"advanced","content":"# Essential to know\\n- Docker containerizes your application\\n- Multi-stage builds for optimized images\\n- Environment variables for config\\n- Health checks for monitoring\\n- Graceful shutdown to avoid interruptions\\n\\n---\\n\\n# Docker for Node.js\\n\\n## Basic Dockerfile\\n\\n```dockerfile\\n# Step 1: Build\\nFROM node:20-alpine AS builder\\n\\nWORKDIR /app\\n\\n# Copy dependency files\\nCOPY package*.json ./\\nRUN npm ci --only=production\\n\\n# Step 2: Production\\nFROM node:20-alpine\\n\\n# Create non-root user (security)\\nRUN addgroup -g 1001 -S nodejs\\nRUN adduser -S nodejs -u 1001\\n\\nWORKDIR /app\\n\\n# Copy from build step\\nCOPY --from=builder --chown=nodejs:nodejs /app/node_modules ./node_modules\\nCOPY --chown=nodejs:nodejs . .\\n\\n# Switch user\\nUSER nodejs\\n\\n# Expose port\\nEXPOSE 3000\\n\\n# Health check\\nHEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \\\\\\\\n  CMD node healthcheck.js\\n\\n# Start application\\nCMD [\\\"node\\\", \\\"index.js\\\"]\\n```\\n\\n## Docker Compose\\n\\n```yaml\\n# docker-compose.yml\\nversion: '3.8'\\n\\nservices:\\n  app:\\n    build: .\\n    ports:\\n      - \\\"3000:3000\\\"\\n    environment:\\n      - NODE_ENV=production\\n      - DATABASE_URL=postgresql://postgres:password@db:5432/myapp\\n      - REDIS_URL=redis://redis:6379\\n    depends_on:\\n      - db\\n      - redis\\n    restart: unless-stopped\\n    \\n  db:\\n    image: postgres:15-alpine\\n    environment:\\n      - POSTGRES_USER=postgres\\n      - POSTGRES_PASSWORD=password\\n      - POSTGRES_DB=myapp\\n    volumes:\\n      - postgres_data:/var/lib/postgresql/data\\n    restart: unless-stopped\\n    \\n  redis:\\n    image: redis:7-alpine\\n    restart: unless-stopped\\n    \\nvolumes:\\n  postgres_data:\\n```\\n\\n## Graceful Shutdown\\n\\n```javascript\\n// index.js\\nimport app from './app.js';\\nimport { closeDatabase } from './db.js';\\n\\nconst server = app.listen(process.env.PORT || 3000, () => {\\n  console.log(`Server ..."},{"id":"production-monitoring","moduleId":"express-production","title":"Monitoring and Logging","order":4,"difficulty":"advanced","content":"# Essential to know\\n- Structured logging (JSON) to facilitate analysis\\n- Centralize logs with ELK, Datadog or Grafana\\n- Monitor application metrics\\n- Alerts on errors and performance\\n- Distributed tracing to debug requests\\n\\n---\\n\\n# Express Application Monitoring\\n\\n## 1. Structured logging with Winston\\n\\n```javascript\\n// utils/logger.js\\nimport winston from 'winston';\\n\\nconst { combine, timestamp, json, errors } = winston.format;\\n\\nconst logger = winston.createLogger({\\n  level: process.env.LOG_LEVEL || 'info',\\n  defaultMeta: {\\n    service: 'my-api',\\n    environment: process.env.NODE_ENV\\n  },\\n  format: combine(\\n    timestamp(),\\n    errors({ stack: true }),\\n    json()\\n  ),\\n  transports: [\\n    new winston.transports.Console(),\\n    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),\\n    new winston.transports.File({ filename: 'logs/combined.log' })\\n  ]\\n});\\n\\nexport default logger;\\n```\\n\\n## 2. Request logging middleware\\n\\n```javascript\\n// middleware/requestLogger.js\\nimport logger from '../utils/logger.js';\\n\\nexport const requestLogger = (req, res, next) => {\\n  const start = Date.now();\\n  \\n  res.on('finish', () => {\\n    const duration = Date.now() - start;\\n    \\n    logger.info('Request completed', {\\n      requestId: req.id,\\n      method: req.method,\\n      url: req.originalUrl,\\n      status: res.statusCode,\\n      duration: `${duration}ms`,\\n      ip: req.ip,\\n      userAgent: req.get('User-Agent'),\\n      userId: req.user?.id\\n    });\\n  });\\n  \\n  next();\\n};\\n```\\n\\n## 3. Metrics with prom-client\\n\\n```javascript\\n// metrics.js\\nimport promClient from 'prom-client';\\n\\n// Create registry\\nconst register = new promClient.Registry();\\npromClient.collectDefaultMetrics({ register });\\n\\n// Custom metrics\\nconst httpRequestDuration = new promClient.Histogram({\\n  name: 'http_request_duration_seconds',\\n  help: 'Duration of HTTP requests i..."}],"exercises":[]}
