{
  "module": {
    "id": "effects",
    "title": "useEffect Hook",
    "description": "Handle side effects and lifecycle in components",
    "icon": "Zap",
    "requiredXp": 600,
    "color": "from-yellow-400 to-yellow-600",
    "courseId": "react"
  },
  "lessons": [
    {
      "id": "effects-intro",
      "moduleId": "effects",
      "title": "Introduction to useEffect",
      "order": 1,
      "difficulty": "intermediate",
      "content": "# Essential to know\n- `useEffect` handles side effects (API calls, subscriptions).\n- Runs after every render by default.\n- Dependency array `[]` controls when it runs.\n\n---\n\n# Introduction to useEffect\n\n`useEffect` lets you perform **side effects** in components.\n\n## What are Side Effects?\n\nSide effects are anything that affects something outside the component:\n- Fetching data from an API\n- Setting up subscriptions\n- Changing the document title\n- Accessing browser APIs\n\n## Basic Syntax\n\n```jsx\nimport { useEffect } from 'react';\n\nuseEffect(() => {\n  // Side effect code here\n  document.title = 'My App';\n});\n```\n\n## When Does it Run?\n\nBy default, useEffect runs **after every render**.\n\n```jsx\nfunction Counter({ count }) {\n  useEffect(() => {\n    document.title = `Count: ${count}`;\n  });\n  // Updates title after every render\n}\n```\n\n## The Dependency Array\n\nControl when the effect runs with dependencies:\n\n```jsx\n// Runs on every render\nuseEffect(() => { ... });\n\n// Runs only on mount\nuseEffect(() => { ... }, []);\n\n// Runs when 'count' changes\nuseEffect(() => { ... }, [count]);\n```",
      "codeExample": "import { useState, useEffect } from 'react';\n\nfunction Timer() {\n  const [seconds, setSeconds] = useState(0);\n\n  useEffect(() => {\n    document.title = `Timer: ${seconds}s`;\n  }, [seconds]);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setSeconds(s => s + 1);\n    }, 1000);\n\n    // Cleanup function\n    return () => clearInterval(interval);\n  }, []); // Empty array = run once on mount\n\n  return <h1>{seconds} seconds</h1>;\n}"
    },
    {
      "id": "effects-cleanup",
      "moduleId": "effects",
      "title": "Effect Cleanup",
      "order": 2,
      "difficulty": "advanced",
      "content": "# Essential to know\n- Clean up side effects to prevent memory leaks.\n- Return a cleanup function from `useEffect`.\n- Runs before next effect or on unmount.\n- Essential for event listeners, timers.\n\n---\n\n# Effect Cleanup\n\nSome effects need **cleanup** to avoid memory leaks and bugs.\n\n## When to Clean Up\n\n- Event listeners\n- Timers and intervals\n- Subscriptions\n- WebSocket connections\n\n## Cleanup Function\n\nReturn a function from useEffect to clean up:\n\n```jsx\nuseEffect(() => {\n  const handleResize = () => {\n    console.log(window.innerWidth);\n  };\n\n  window.addEventListener('resize', handleResize);\n\n  // Cleanup function\n  return () => {\n    window.removeEventListener('resize', handleResize);\n  };\n}, []);\n```\n\n## When Cleanup Runs\n\n1. **Before the next effect** runs\n2. **When component unmounts**\n\n## Timer Example\n\n```jsx\nuseEffect(() => {\n  const timer = setTimeout(() => {\n    setMessage('Time is up!');\n  }, 3000);\n\n  return () => clearTimeout(timer);\n}, []);\n```\n\nWithout cleanup, you might set state on an unmounted component!",
      "codeExample": "import { useState, useEffect } from 'react';\n\nfunction MouseTracker() {\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n\n  useEffect(() => {\n    const handleMouseMove = (event) => {\n      setPosition({\n        x: event.clientX,\n        y: event.clientY,\n      });\n    };\n\n    window.addEventListener('mousemove', handleMouseMove);\n\n    // Cleanup: remove listener when component unmounts\n    return () => {\n      window.removeEventListener('mousemove', handleMouseMove);\n    };\n  }, []);\n\n  return (\n    <div>\n      Mouse position: {position.x}, {position.y}\n    </div>\n  );\n}"
    },
    {
      "id": "effects-data-fetching",
      "moduleId": "effects",
      "title": "Data Fetching",
      "order": 3,
      "difficulty": "intermediate",
      "content": "# Essential to know\n- Fetch data inside `useEffect`.\n- Use `[]` to run once on mount.\n- Handle loading and error states.\n\n---\n\n# Fetching Data with useEffect\n\n## Basic Pattern\n\n```jsx\nfunction UserList() {\n  const [users, setUsers] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetch('/api/users')\n      .then(res => res.json())\n      .then(data => {\n        setUsers(data);\n        setLoading(false);\n      });\n  }, []);\n\n  if (loading) return <p>Loading...</p>;\n  return <ul>{users.map(u => <li key={u.id}>{u.name}</li>)}</ul>;\n}\n```\n\n## With Error Handling\n\nAlways handle errors in production code:\n\n```jsx\nconst [error, setError] = useState(null);\n\nuseEffect(() => {\n  fetch('/api/data')\n    .then(res => {\n      if (!res.ok) throw new Error('Failed');\n      return res.json();\n    })\n    .then(setData)\n    .catch(setError)\n    .finally(() => setLoading(false));\n}, []);\n```",
      "codeExample": "import { useState, useEffect } from 'react';\n\nfunction PostList() {\n  const [posts, setPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    fetch('https://jsonplaceholder.typicode.com/posts?_limit=5')\n      .then(res => {\n        if (!res.ok) throw new Error('Network error');\n        return res.json();\n      })\n      .then(data => {\n        setPosts(data);\n        setLoading(false);\n      })\n      .catch(err => {\n        setError(err.message);\n        setLoading(false);\n      });\n  }, []);\n\n  if (loading) return <p>Loading posts...</p>;\n  if (error) return <p>Error: {error}</p>;\n\n  return (\n    <ul>\n      {posts.map(post => (\n        <li key={post.id}>\n          <strong>{post.title}</strong>\n        </li>\n      ))}\n    </ul>\n  );\n}"
    }
  ],
  "exercises": [
    {
      "id": "effects-ex-1",
      "lessonId": "effects-intro",
      "moduleId": "effects",
      "title": "Document Title",
      "difficulty": "easy",
      "description": "Update the document title with useEffect.",
      "instructions": "Create a `TitleUpdater` component that:\n1. Has a `count` state starting at 0\n2. Uses useEffect to update document.title to \"Count: {count}\"\n3. Has a button to increment the count",
      "starterCode": "import { useState, useEffect } from 'react';\n\nfunction TitleUpdater() {\n  // Create count state\n  // Use useEffect to update document.title\n  // Return count display and button\n\n}",
      "solution": "import { useState, useEffect } from 'react';\n\nfunction TitleUpdater() {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    document.title = `Count: ${count}`;\n  }, [count]);\n\n  return (\n    <div>\n      <p>Count: {count}</p>\n      <button onClick={() => setCount(count + 1)}>\n        Increment\n      </button>\n    </div>\n  );\n}",
      "hints": [
        "Put document.title update inside useEffect",
        "Add [count] as dependency array so it runs when count changes"
      ],
      "validationPrompt": "Check if TitleUpdater uses useEffect to update document.title when count changes"
    },
    {
      "id": "effects-ex-2",
      "lessonId": "effects-intro",
      "moduleId": "effects",
      "title": "Page View Counter",
      "difficulty": "easy",
      "description": "Log when component mounts.",
      "instructions": "Create a `PageTracker` component that:\n1. Uses useEffect to console.log \"Page viewed\" on mount\n2. Uses empty dependency array []\n3. Displays \"Welcome to the page\"",
      "starterCode": "import { useEffect } from 'react';\n\nfunction PageTracker() {\n  // Log on mount\n\n}",
      "solution": "import { useEffect } from 'react';\n\nfunction PageTracker() {\n  useEffect(() => {\n    console.log(\"Page viewed\");\n  }, []);\n\n  return <p>Welcome to the page</p>;\n}",
      "hints": [
        "Empty array [] means run only on mount",
        "Put console.log inside useEffect"
      ],
      "validationPrompt": "Check if PageTracker uses useEffect with empty deps to log on mount"
    },
    {
      "id": "effects-ex-3",
      "lessonId": "effects-cleanup",
      "moduleId": "effects",
      "title": "Timer with Cleanup",
      "difficulty": "advanced",
      "description": "Create a timer that cleans up.",
      "instructions": "Create a `Timer` component that:\n1. Has seconds state starting at 0\n2. Uses setInterval to increment every second\n3. Cleans up the interval on unmount\n4. Displays \"Seconds: {seconds}\"",
      "starterCode": "import { useState, useEffect } from 'react';\n\nfunction Timer() {\n  // Create timer with cleanup\n\n}",
      "solution": "import { useState, useEffect } from 'react';\n\nfunction Timer() {\n  const [seconds, setSeconds] = useState(0);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setSeconds(s => s + 1);\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  return <p>Seconds: {seconds}</p>;\n}",
      "hints": [
        "Store interval ID to clear later",
        "Return cleanup function from useEffect",
        "Use s => s + 1 to avoid stale state"
      ],
      "validationPrompt": "Check if Timer uses setInterval with cleanup via clearInterval"
    },
    {
      "id": "fetch-1",
      "lessonId": "effects-data-fetching",
      "moduleId": "effects",
      "title": "Fetch User Data",
      "difficulty": "advanced",
      "description": "Fetch and display data.",
      "instructions": "Create a `UserInfo` component that:\n1. Has user state (null) and loading state (true)\n2. Fetches from \"https://api.example.com/user\" on mount\n3. Shows \"Loading...\" while loading\n4. Shows user.name when loaded",
      "starterCode": "import { useState, useEffect } from 'react';\n\nfunction UserInfo() {\n  // Fetch user data on mount\n\n}",
      "solution": "import { useState, useEffect } from 'react';\n\nfunction UserInfo() {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetch(\"https://api.example.com/user\")\n      .then(res => res.json())\n      .then(data => {\n        setUser(data);\n        setLoading(false);\n      });\n  }, []);\n\n  if (loading) return <p>Loading...</p>;\n  return <p>{user.name}</p>;\n}",
      "hints": [
        "Use empty [] for mount-only effect",
        "Set loading false after data arrives"
      ],
      "validationPrompt": "Check if useEffect fetches data and manages loading state"
    }
  ]
}