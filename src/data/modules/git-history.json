{
  "module": {
    "id": "git-history",
    "title": "History & Undoing",
    "description": "Learn to view history, compare versions, and undo changes safely",
    "icon": "History",
    "requiredXp": 450,
    "color": "from-green-400 to-emerald-600",
    "courseId": "git"
  },
  "lessons": [
    {
      "id": "git-log",
      "moduleId": "git-history",
      "title": "Viewing Commit History",
      "order": 1,
      "difficulty": "beginner",
      "content": "# Essential to know\n- `git log` shows commit history\n- `git log --oneline` shows compact history\n- `git log -n` shows last n commits\n- `git log --graph` shows branch visualization\n- `git log --all` shows all branches' history\n\n---\n\n# Viewing Commit History\n\nGit keeps a complete history of your project. Learn how to navigate and understand it.\n\n## Basic Log\n\n```bash\n# Show commit history\ngit log\n```\n\nShows:\n- Commit hash (SHA)\n- Author and date\n- Commit message\n- Full diff (press space to scroll, q to quit)\n\n## Compact Log\n\n```bash\n# One line per commit\ngit log --oneline\n\n# Output:\n# a1b2c3d Add login page\n# e4f5g6h Fix navigation bug\n# i7j8k9l Initial commit\n```\n\n## Limiting Output\n\n```bash\n# Show last 5 commits\ngit log -5\n\n# Show last 10 commits\ngit log -10 --oneline\n```\n\n## Visualizing Branches\n\n```bash\n# Show graph with branches\ngit log --graph --oneline --all\n\n# Output shows branch structure with * and lines\n```\n\n## Log Options\n\n```bash\n# Show all branches\ngit log --all\n\n# Show decorated with branch/tag names\ngit log --oneline --decorate\n\n# Show file statistics\ngit log --stat\n\n# Show which files changed\ngit log --name-only\n```\n\n## Filtering History\n\n```bash\n# By author\ngit log --author=\"John\"\n\n# By date\ngit log --since=\"1 week ago\"\ngit log --until=\"2024-01-01\"\n\n# By file\ngit log -- README.md\n\n# Search commit messages\ngit log --grep=\"bugfix\"\n```\n\n## Pretty Formats\n\n```bash\n# Custom format\ngit log --pretty=format:\"%h - %an, %ar : %s\"\n\n# Common placeholders:\n# %h = short hash\n# %an = author name\n# %ar = author date, relative\n# %s = subject (message)\n```",
      "codeExample": "# View full log\ngit log\n\n# Compact one-line view\ngit log --oneline\n\n# Last 10 commits\ngit log -10 --oneline\n\n# Graph view with all branches\ngit log --graph --oneline --all\n\n# Show commits affecting a specific file\ngit log -- README.md"
    },
    {
      "id": "git-show",
      "moduleId": "git-history",
      "title": "Inspecting Commits",
      "order": 2,
      "difficulty": "beginner",
      "content": "# Essential to know\n- `git show` displays a specific commit\n- Shows commit info and diff in one view\n- Use commit hash (full or abbreviated)\n- `git show HEAD` shows the latest commit\n- `git show HEAD~1` shows the commit before last\n\n---\n\n# Inspecting Commits\n\nSometimes you need to see exactly what changed in a specific commit.\n\n## git show\n\n```bash\n# Show the latest commit\ngit show\n\n# Show specific commit by hash\ngit show a1b2c3d\n\n# Show with short hash\ngit show a1b2c3\n```\n\n## Relative References\n\n```bash\n# Show last commit\ngit show HEAD\n\n# Show commit before last\ngit show HEAD~1\n\n# Show 3 commits ago\ngit show HEAD~3\n```\n\n## Show Specific Files\n\n```bash\n# Show what changed in a file in a commit\ngit show a1b2c3d:filename.txt\n\n# Show file as it was at that commit\ngit show a1b2c3d -- path/to/file.js\n```\n\n## Show Statistics\n\n```bash\n# Show stats only (no diff)\ngit show --stat a1b2c3d\n\n# Show just the commit message\ngit show --quiet a1b2c3d\n```\n\n## Viewing File History\n\n```bash\n# See all changes to a specific file\ngit log -p -- filename.txt\n\n# Who changed each line (blame)\ngit blame filename.txt\n\n# Blame with specific range\ngit blame -L 10,20 filename.txt\n```",
      "codeExample": "# Show latest commit\ngit show\n\n# Show specific commit\ngit show abc1234\n\n# Show commit before last\ngit show HEAD~1\n\n# Show who changed each line\ngit blame README.md\n\n# Show file at specific commit\ngit show abc1234:README.md"
    },
    {
      "id": "git-diff-advanced",
      "moduleId": "git-history",
      "title": "Comparing Versions",
      "order": 3,
      "difficulty": "intermediate",
      "content": "# Essential to know\n- `git diff` compares different versions\n- `git diff commit1 commit2` compares two commits\n- `git diff HEAD~1` compares with previous commit\n- `git diff branch1 branch2` compares branches\n- Understanding diff output is crucial\n\n---\n\n# Comparing Versions\n\nGit diff is powerful for comparing any two versions of your code.\n\n## Comparing Commits\n\n```bash\n# Compare two commits\ngit diff abc1234 def5678\n\n# Compare with previous commit\ngit diff HEAD~1 HEAD\n\n# Compare with specific commit\ngit diff abc1234\n```\n\n## Comparing Branches\n\n```bash\n# See what's in feature but not in main\ngit diff main feature\n\n# See what would be merged\ngit diff main...feature\n```\n\n## Understanding Diff Output\n\n```diff\ndiff --git a/file.txt b/file.txt\nindex 1234567..abcdefg 100644\n--- a/file.txt    (old version)\n+++ b/file.txt    (new version)\n@@ -1,5 +1,5 @@     (line numbers)\n Line 1 unchanged\n-Line 2 removed\n+Line 2 added\n Line 3 unchanged\n```\n\n- Lines starting with - were removed\n- Lines starting with + were added\n- Context lines help you locate changes\n\n## Diff Options\n\n```bash\n# Show only filenames\ngit diff --name-only\n\n# Show statistics\ngit diff --stat\n\n# Show word-by-word diff\ngit diff --word-diff\n\n# Ignore whitespace\ngit diff -w\n```\n\n## Staged vs Unstaged\n\n```bash\n# Unstaged changes (working directory)\ngit diff\n\n# Staged changes (index)\ngit diff --staged\ngit diff --cached\n\n# Both\ngit diff HEAD\n```",
      "codeExample": "# Compare working directory with staging area\ngit diff\n\n# Compare staging area with last commit\ngit diff --staged\n\n# Compare two commits\ngit diff abc1234 def5678\n\n# Compare branches\ngit diff main feature\n\n# Show only filenames that changed\ngit diff --name-only"
    },
    {
      "id": "git-undo",
      "moduleId": "git-history",
      "title": "Undoing Changes",
      "order": 4,
      "difficulty": "intermediate",
      "content": "# Essential to know\n- `git restore` undoes uncommitted changes\n- `git restore --staged` unstages files\n- `git checkout -- file` restores file to last commit\n- These commands can lose work - be careful!\n- Only affects uncommitted changes\n\n---\n\n# Undoing Changes\n\nGit provides several ways to undo changes at different stages.\n\n## Discarding Local Changes\n\n```bash\n# Restore file to last committed state\ngit restore filename.txt\n\n# Restore all files in current directory\ngit restore .\n\n# Old syntax (still works)\ngit checkout -- filename.txt\n```\n\n⚠️ **Warning**: This permanently deletes your local changes!\n\n## Unstaging Files\n\n```bash\n# Remove file from staging area\ngit restore --staged filename.txt\n\n# Unstage all files\ngit restore --staged .\n\n# Old syntax\ngit reset HEAD filename.txt\n```\n\nThis keeps your changes but removes them from staging.\n\n## Discarding Everything\n\n```bash\n# Discard all uncommitted changes\ngit restore .\n\n# Unstage and discard\ngit reset --hard\n```\n\n⚠️ **DANGER**: `git reset --hard` deletes all uncommitted work!\n\n## Safe Alternatives\n\nBefore discarding, consider:\n\n```bash\n# Stash changes instead of deleting\ngit stash\n\n# Later, get them back\ngit stash pop\n```\n\n## Undo Scenarios\n\n**I modified a file but haven't staged:**\n```bash\ngit restore filename.txt\n```\n\n**I staged a file but haven't committed:**\n```bash\ngit restore --staged filename.txt  # Unstage\ngit restore filename.txt            # Discard changes\n```\n\n**I want to start over completely:**\n```bash\ngit reset --hard HEAD  # ⚠️ Destructive!\n```\n\n## Check Before Undoing\n\nAlways check what you'll lose:\n\n```bash\n# See what would be discarded\ngit diff\n\n# See what's staged\ngit diff --staged\n```",
      "codeExample": "# Discard changes in a file\ngit restore config.js\n\n# Unstage a file\ngit restore --staged README.md\n\n# Discard all uncommitted changes\ngit restore .\n\n# Stash instead of discarding (safer)\ngit stash\n\n# Get stashed changes back\ngit stash pop"
    },
    {
      "id": "git-revert",
      "moduleId": "git-history",
      "title": "Reverting Commits",
      "order": 5,
      "difficulty": "intermediate",
      "content": "# Essential to know\n- `git revert` creates a new commit that undoes a previous commit\n- Safe for shared history - doesn't rewrite history\n- `git revert HEAD` undoes the last commit\n- `git revert abc1234` undoes a specific commit\n- Use for commits that have been pushed\n\n---\n\n# Reverting Commits\n\nRevert is the safe way to undo commits that have already been shared.\n\n## How Revert Works\n\nInstead of deleting a commit, revert creates a new commit that does the opposite:\n\n```\nBefore:  A---B---C (bad commit)\n                  ↓\nAfter:   A---B---C---D (revert commit that undoes C)\n```\n\n## Basic Revert\n\n```bash\n# Revert the last commit\ngit revert HEAD\n\n# Revert a specific commit\ngit revert abc1234\n\n# Revert without opening editor\ngit revert --no-edit HEAD\n```\n\n## Reverting Multiple Commits\n\n```bash\n# Revert a range of commits\ngit revert abc1234..def5678\n\n# Revert multiple specific commits\ngit revert abc1234 def5678\n```\n\n## Handling Conflicts\n\nIf the revert causes conflicts:\n\n```bash\ngit revert abc1234\n# Auto-merging file.txt\n# CONFLICT (content): Merge conflict in file.txt\n\n# Fix the conflicts...\ngit add .\ngit revert --continue\n\n# Or abort\ngit revert --abort\n```\n\n## Revert vs Reset\n\n| Revert | Reset |\n|--------|-------|\n| Creates new commit | Moves branch pointer |\n| Safe for shared history | Rewrites history |\n| Can be used on pushed commits | Only for local changes |\n| Doesn't delete history | Can delete commits |\n\n## When to Use Revert\n\n**Use revert when:**\n- The commit has been pushed to remote\n- Others might have based work on it\n- You want to keep a record of the change\n\n**Example workflow:**\n```bash\n# Oops, last commit introduced a bug\n# It's already pushed\ngit revert HEAD\n\n# This creates a new commit that undoes the bug\n# Push the revert\ngit push\n```",
      "codeExample": "# Revert the last commit\ngit revert HEAD\n\n# Revert specific commit\ngit revert abc1234\n\n# Revert without editing message\ngit revert --no-edit HEAD\n\n# Revert a range\ngit revert abc1234..def5678"
    }
  ],
  "exercises": [
    {
      "id": "history-ex-1",
      "type": "git-scenario",
      "lessonId": "git-undo",
      "moduleId": "git-history",
      "title": "Undo Staged Changes",
      "difficulty": "easy",
      "story": "You accidentally staged config.js which contains sensitive data. Unstage it before committing, but keep your other staged files ready.",
      "hints": [
        "Use 'git restore --staged config.js' to unstage just that file",
        "Then commit the remaining staged files"
      ],
      "initialState": {
        "files": [
          { "name": "index.html", "status": "staged" },
          { "name": "style.css", "status": "staged" },
          { "name": "config.js", "status": "staged" }
        ],
        "commits": [{ "message": "Initial commit", "files": ["index.html", "style.css", "config.js"] }],
        "branches": ["main"],
        "currentBranch": "main",
        "isInitialized": true
      },
      "objectives": [
        { "description": "Unstage config.js", "check": { "type": "fileStatus", "file": "config.js", "status": "modified" } },
        { "description": "Commit the safe files", "check": { "type": "minCommits", "value": 2 } }
      ]
    },
    {
      "id": "history-ex-2",
      "type": "git-scenario",
      "lessonId": "git-undo",
      "moduleId": "git-history",
      "title": "Discard Local Changes",
      "difficulty": "medium",
      "story": "You made some experimental changes to app.js that didn't work out. Discard the changes to restore the file to its last committed state.",
      "hints": [
        "Use 'git restore app.js' to discard local changes",
        "Warning: this permanently removes your uncommitted changes!"
      ],
      "initialState": {
        "files": [
          { "name": "index.html", "status": "committed" },
          { "name": "app.js", "status": "modified" },
          { "name": "style.css", "status": "committed" }
        ],
        "commits": [{ "message": "Initial commit", "files": ["index.html", "app.js", "style.css"] }],
        "branches": ["main"],
        "currentBranch": "main",
        "isInitialized": true
      },
      "objectives": [
        { "description": "Restore app.js to its committed state", "check": { "type": "fileStatus", "file": "app.js", "status": "committed" } }
      ]
    },
    {
      "id": "history-ex-3",
      "type": "git-scenario",
      "lessonId": "git-undo",
      "moduleId": "git-history",
      "title": "Clean Up Working Directory",
      "difficulty": "medium",
      "story": "Your working directory is a mess — some files are modified, some are staged. Clean everything up: unstage the staged files, then discard all modifications to get a clean tree.",
      "hints": [
        "First unstage with 'git restore --staged .'",
        "Then discard modifications with 'git restore .'"
      ],
      "initialState": {
        "files": [
          { "name": "index.html", "status": "staged" },
          { "name": "app.js", "status": "modified" },
          { "name": "utils.js", "status": "committed" }
        ],
        "commits": [{ "message": "Initial commit", "files": ["index.html", "app.js", "utils.js"] }],
        "branches": ["main"],
        "currentBranch": "main",
        "isInitialized": true
      },
      "objectives": [
        { "description": "All files are committed (clean tree)", "check": { "type": "allFilesCommitted" } }
      ]
    },
    {
      "id": "history-ex-4",
      "type": "quiz",
      "lessonId": "git-log",
      "moduleId": "git-history",
      "title": "Git Log Quiz",
      "difficulty": "easy",
      "questions": [
        {
          "question": "What does 'git log --oneline' show?",
          "options": [
            "Only the first commit ever made",
            "A compact view with one commit per line (hash + message)",
            "The full diff of every commit",
            "Only commits from today"
          ],
          "correctAnswer": 1,
          "explanation": "git log --oneline shows each commit on a single line with its abbreviated hash and commit message, making it easy to scan the project history."
        },
        {
          "question": "How do you view only the last 3 commits?",
          "options": [
            "git log --last 3",
            "git log -3",
            "git log --limit=3",
            "git log --count 3"
          ],
          "correctAnswer": 1,
          "explanation": "git log -3 limits the output to the 3 most recent commits. You can combine it with other flags like --oneline for a compact view."
        }
      ]
    },
    {
      "id": "history-ex-5",
      "type": "quiz",
      "lessonId": "git-show",
      "moduleId": "git-history",
      "title": "Inspecting Commits Quiz",
      "difficulty": "easy",
      "questions": [
        {
          "question": "What does HEAD~1 refer to?",
          "options": [
            "The next commit to be made",
            "The first commit in the repository",
            "The commit before the current HEAD",
            "A branch named HEAD"
          ],
          "correctAnswer": 2,
          "explanation": "HEAD~1 is a relative reference meaning 'one commit before HEAD'. HEAD points to the latest commit, so HEAD~1 is the parent commit. HEAD~2 would be two commits back, and so on."
        },
        {
          "question": "What does 'git blame' show?",
          "options": [
            "A list of all errors in the file",
            "Who last modified each line of a file and when",
            "The difference between two commits",
            "A list of deleted files"
          ],
          "correctAnswer": 1,
          "explanation": "git blame shows each line of a file annotated with the commit hash, author, and date of the last change. It's useful for understanding who changed what and when."
        }
      ]
    },
    {
      "id": "history-ex-6",
      "type": "quiz",
      "lessonId": "git-diff-advanced",
      "moduleId": "git-history",
      "title": "Comparing Versions Quiz",
      "difficulty": "medium",
      "questions": [
        {
          "question": "What does a line starting with '+' mean in git diff output?",
          "options": [
            "A line that was removed",
            "A line that was added",
            "A line that was moved",
            "A comment line"
          ],
          "correctAnswer": 1,
          "explanation": "In diff output, lines starting with '+' were added (shown in green), and lines starting with '-' were removed (shown in red). Lines without a prefix are unchanged context lines."
        },
        {
          "question": "What is the difference between 'git diff main feature' and 'git diff main...feature'?",
          "options": [
            "They are exactly the same",
            "Two dots compares tips directly, three dots shows changes since branches diverged",
            "Three dots is invalid syntax",
            "Two dots is for local, three dots is for remote"
          ],
          "correctAnswer": 1,
          "explanation": "'git diff main feature' (two dots implied) compares the tips of both branches directly. 'git diff main...feature' shows only the changes made on the feature branch since it diverged from main."
        }
      ]
    },
    {
      "id": "history-ex-7",
      "type": "quiz",
      "lessonId": "git-revert",
      "moduleId": "git-history",
      "title": "Revert vs Reset Quiz",
      "difficulty": "medium",
      "questions": [
        {
          "question": "What is the key difference between 'git revert' and 'git reset'?",
          "options": [
            "They do the same thing",
            "Revert creates a new commit that undoes changes; reset moves the branch pointer back",
            "Revert only works on branches, reset works on files",
            "Reset is safer because it creates a backup"
          ],
          "correctAnswer": 1,
          "explanation": "git revert creates a new commit that reverses the changes, preserving history. git reset moves the branch pointer backwards, potentially rewriting history. Revert is safe for shared branches."
        },
        {
          "question": "When should you use 'git revert' instead of 'git reset'?",
          "options": [
            "When the commit hasn't been pushed yet",
            "When the commit has already been pushed and others may have pulled it",
            "When you want to delete a branch",
            "When you want to rename a file"
          ],
          "correctAnswer": 1,
          "explanation": "Use git revert when the commit has been pushed to a shared repository. Since revert creates a new commit instead of rewriting history, it won't cause problems for other developers."
        }
      ]
    }
  ]
}
