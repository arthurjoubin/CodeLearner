{
  "module": {
    "id": "browser-storage",
    "title": "Browser Storage",
    "description": "localStorage, sessionStorage, IndexedDB and cookies: store data client-side efficiently",
    "icon": "Database",
    "requiredXp": 1100,
    "color": "from-orange-400 to-red-600",
    "courseId": "javascript-core"
  },
  "lessons": [
    {
      "id": "storage-overview",
      "moduleId": "browser-storage",
      "title": "Storage Overview",
      "order": 1,
      "difficulty": "beginner",
      "content": "# Essential to know\n- 4 client-side storage options: localStorage, sessionStorage, IndexedDB, Cookies\n- localStorage: persistent, 5-10MB, synchronous, string only\n- sessionStorage: like localStorage but only for the session\n- IndexedDB: NoSQL database, 50MB+, async, complex\n- Cookies: 4KB max, sent with every HTTP request\n- Choose based on: size, persistence, sync/async, data structure\n\n---\n\n# Browser Storage: Which Tool to Choose?\n\n## The 4 Options\n\n### Quick Comparison\n\n| Feature | localStorage | sessionStorage | IndexedDB | Cookies |\n|-----------------|--------------|----------------|-----------|---------|\n| **Capacity** | ~5-10MB | ~5-10MB | ~50MB+ | ~4KB |\n| **Persistent** | ‚úÖ Yes | ‚ùå No (session) | ‚úÖ Yes | ‚úÖ Yes |\n| **Async** | ‚ùå No | ‚ùå No | ‚úÖ Yes | ‚ùå No |\n| **Structure** | String | String | Objects/Files | String |\n| **HTTP** | ‚ùå No | ‚ùå No | ‚ùå No | ‚úÖ Yes |\n| **Accessibility** | Very simple | Very simple | Complex | Simple |\n\n## When to use what?\n\n### ‚úÖ localStorage - Good for:\n- User preferences (theme, language)\n- JWT token (if not sensitive)\n- Simple data cache\n- Application state\n- E-commerce cart (temporary)\n\n**Example:**\n```javascript\n// Save theme\nlocalStorage.setItem('theme', 'dark');\n\n// Retrieve on load\nconst theme = localStorage.getItem('theme') || 'light';\ndocument.body.className = theme;\n```\n\n### ‚úÖ sessionStorage - Good for:\n- Temporary data from multi-step forms\n- State during navigation\n- Sensitive data you don't want to persist\n- Cart during the session\n\n**Example:**\n```javascript\n// Multi-step form\n// Step 1\nsessionStorage.setItem('step1', JSON.stringify({ name, email }));\n\n// Step 2\nconst step1Data = JSON.parse(sessionStorage.getItem('step1'));\n```\n\n### ‚úÖ IndexedDB - Good for:\n- Large volumes of data (MB-GB)\n- Structured data co...",
      "codeExample": "// Practical comparison of 4 storage types\n\n// ========== localStorage ==========\n// Simple, persistent, limited to ~5MB\n\n// Save\nlocalStorage.setItem('username', 'Marie');\nlocalStorage.setItem('settings', JSON.stringify({\n  theme: 'dark',\n  fontSize: 16,\n  notifications: true\n}));\n\n// Retrieve\nconst username = localStorage.getItem('username');\nconst settings = JSON.parse(localStorage.getItem('settings'));\n\n// Delete\nlocalStorage.removeItem('username');\n// localStorage.clear(); // Delete all\n\n\n// ========== sessionStorage ==========\n// Same API as localStorage but cleared on close\n\nsessionStorage.setItem('currentStep', '2');\nsessionStorage.setItem('formData', JSON.stringify({\n  name: 'John',\n  email: 'john@example.com'\n}));\n\nconst currentStep = sessionStorage.getItem('currentStep');\n\n\n// ========== Cookies ==========\n// Old API, not very practical\n\n// Set a cookie\ndocument.cookie = 'user=John; expires=Fri, 31 Dec 2024 23:59:59 GMT; path=/; secure; samesite=strict';\n\n// Read all cookies\nconsole.log(document.cookie); // 'user=John; session=abc123'\n\n// Delete (set past date)\ndocument.cookie = 'user=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/';\n\n\n// ========== Modern helper ==========\nconst Storage = {\n  // LocalStorage with automatic JSON\n  set(key, value) {\n    localStorage.setItem(key, JSON.stringify(value));\n  },\n  \n  get(key, defaultValue = null) {\n    const item = localStorage.getItem(key);\n    return item ? JSON.parse(item) : defaultValue;\n  },\n  \n  remove(key) {\n    localStorage.removeItem(key);\n  },\n  \n  // SessionStorage\n  session: {\n    set(key, value) {\n      sessionStorage.setItem(key, JSON.stringify(value));\n    },\n    get(key, defaultValue = null) {\n      const item = sessionStorage.getItem(key);\n      return item ? JSON.parse(item) : defaultValue;\n    }\n  }\n};\n\n// Usage\nStorage.set('user', { name: 'Ma..."
    },
    {
      "id": "local-session-storage",
      "moduleId": "browser-storage",
      "title": "localStorage & sessionStorage",
      "order": 2,
      "difficulty": "beginner",
      "content": "# Essential to know\n- Simple API: setItem, getItem, removeItem, clear\n- Strings only (use JSON.stringify/parse)\n- Domain storage (same origin policy)\n- Synchronous (blocks thread if large volume)\n- 'storage' event for sync between tabs\n- sessionStorage = same API but cleared on tab close\n\n---\n\n# localStorage and sessionStorage in Detail\n\n## Basic API\n\nBoth have the same simple API:\n\n```javascript\n// Store\nlocalStorage.setItem('key', 'value');\nsessionStorage.setItem('key', 'value');\n\n// Retrieve\nconst value = localStorage.getItem('key');\nconst value = sessionStorage.getItem('key');\n\n// Delete one entry\nlocalStorage.removeItem('key');\n\n// Delete all\nlocalStorage.clear();\n\n// Number of items\nconsole.log(localStorage.length);\n\n// Get key by index\nconst key = localStorage.key(0);\n```\n\n## Storing Objects\n\n```javascript\n// ‚ùå Doesn't work\nconst user = { name: 'Marie', age: 30 };\nlocalStorage.setItem('user', user);\nconsole.log(localStorage.getItem('user')); // '[object Object]' üò±\n\n// ‚úÖ Use JSON\nlocalStorage.setItem('user', JSON.stringify(user));\n\n// Retrieve\nconst userData = JSON.parse(localStorage.getItem('user'));\nconsole.log(userData.name); // 'Marie'\n```\n\n### Type-Safe Helper\n\n```typescript\nclass TypedStorage {\n  static set<T>(key: string, value: T): void {\n    try {\n      localStorage.setItem(key, JSON.stringify(value));\n    } catch (e) {\n      console.error('Storage error:', e);\n    }\n  }\n\n  static get<T>(key: string, defaultValue?: T): T | undefined {\n    try {\n      const item = localStorage.getItem(key);\n      return item ? JSON.parse(item) : defaultValue;\n    } catch (e) {\n      console.error('Parse error:', e);\n      return defaultValue;\n    }\n  }\n\n  static remove(key: string): void {\n    localStorage.removeItem(key);\n  }\n}\n\n// Usage\ninterface User {\n  id: number;\n  name: string;\n}\n\nType...",
      "codeExample": "// Complete examples localStorage/sessionStorage\n\n// ========== 1. Preferences system ==========\nconst Preferences = {\n  defaults: {\n    theme: 'light',\n    language: 'fr',\n    fontSize: 16,\n    notifications: true,\n    sidebarCollapsed: false\n  },\n  \n  get(key) {\n    const stored = localStorage.getItem('prefs');\n    const prefs = stored ? JSON.parse(stored) : {};\n    return prefs[key] ?? this.defaults[key];\n  },\n  \n  set(key, value) {\n    const stored = localStorage.getItem('prefs');\n    const prefs = stored ? JSON.parse(stored) : {};\n    prefs[key] = value;\n    localStorage.setItem('prefs', JSON.stringify(prefs));\n    \n    // Notify other tabs\n    window.dispatchEvent(new CustomEvent('pref-changed', {\n      detail: { key, value }\n    }));\n  },\n  \n  getAll() {\n    const stored = localStorage.getItem('prefs');\n    return { ...this.defaults, ...(stored ? JSON.parse(stored) : {}) };\n  },\n  \n  reset() {\n    localStorage.removeItem('prefs');\n  }\n};\n\n// Usage\nPreferences.set('theme', 'dark');\nconsole.log(Preferences.get('theme')); // 'dark'\n\n\n// ========== 2. Search history ==========\nconst SearchHistory = {\n  key: 'search_history',\n  maxItems: 10,\n  \n  getAll() {\n    return JSON.parse(localStorage.getItem(this.key)) || [];\n  },\n  \n  add(query) {\n    let history = this.getAll();\n    \n    // Remove if already exists\n    history = history.filter(item => item !== query);\n    \n    // Add to beginning\n    history.unshift(query);\n    \n    // Keep only maxItems\n    history = history.slice(0, this.maxItems);\n    \n    localStorage.setItem(this.key, JSON.stringify(history));\n  },\n  \n  remove(query) {\n    const history = this.getAll().filter(item => item !== query);\n    localStorage.setItem(this.key, JSON.stringify(history));\n  },\n  \n  clear() {\n    localStorage.removeItem(this.key);\n  }\n};\n\n\n// ========== 3. Temporary session ==========\nclass Tempor..."
    },
    {
      "id": "indexeddb",
      "moduleId": "browser-storage",
      "title": "IndexedDB: Browser Database",
      "order": 3,
      "difficulty": "advanced",
      "content": "# Essential to know\n- IndexedDB = client-side NoSQL database\n- Large storage (50MB to several GB depending on browser)\n- Asynchronous (event-based or Promise API)\n- Supports indexes, transactions, cursors\n- Stores objects, files, blobs\n- Complex native API ‚Üí use wrappers (idb, localForage)\n- Perfect for offline-first apps\n\n---\n\n# IndexedDB: The Browser Database\n\n## Why IndexedDB?\n\n**localStorage is limited:**\n- Max ~5-10MB\n- Strings only\n- No efficient search\n- Synchronous (blocks UI)\n\n**IndexedDB offers:**\n- Large storage (50MB ‚Üí several GB)\n- Native object storage\n- Indexes for fast search\n- Transactions\n- Async (doesn't block)\n- File/binary support\n\n## Key Concepts\n",
      "codeExample": "// Complete IndexedDB example with idb\n\nimport { openDB } from 'idb';\n\n// ========== Initialization ==========\nconst DB_NAME = 'TaskManager';\nconst DB_VERSION = 1;\n\nasync function getDB() {\n  return openDB(DB_NAME, DB_VERSION, {\n    upgrade(db, oldVersion, newVersion, transaction) {\n      console.log(`DB update: ${oldVersion} ‚Üí ${newVersion}`);\n      \n      // Tasks Store\n      if (!db.objectStoreNames.contains('tasks')) {\n        const taskStore = db.createObjectStore('tasks', {\n          keyPath: 'id',\n          autoIncrement: true\n        });\n        \n        // Indexes for fast search\n        taskStore.createIndex('byStatus', 'status');\n        taskStore.createIndex('byPriority', 'priority');\n        taskStore.createIndex('byDueDate', 'dueDate');\n        taskStore.createIndex('byProject', 'projectId');\n      }\n      \n      // Projects Store\n      if (!db.objectStoreNames.contains('projects')) {\n        db.createObjectStore('projects', {\n          keyPath: 'id',\n          autoIncrement: true\n        });\n      }\n    }\n  });\n}\n\n// ========== Tasks API ==========\nexport const TaskDB = {\n  // Basic CRUD\n  async create(task) {\n    const db = await getDB();\n    const newTask = {\n      ...task,\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n      status: task.status || 'todo'\n    };\n    const id = await db.add('tasks', newTask);\n    return { ...newTask, id };\n  },\n  \n  async getById(id) {\n    const db = await getDB();\n    return db.get('tasks', id);\n  },\n  \n  async update(id, updates) {\n    const db = await getDB();\n    const existing = await db.get('tasks', id);\n    if (!existing) throw new Error('Task not found');\n    \n    const updated = {\n      ...existing,\n      ...updates,\n      id,\n      updatedAt: Date.now()\n    };\n    await db.put('tasks', updated);\n    return updated;\n  },\n  \n  async delete(id) {\n    const db = await getDB();\n    await db.dele..."
    },
    {
      "id": "cookies-security",
      "moduleId": "browser-storage",
      "title": "Cookies and Security",
      "order": 4,
      "difficulty": "intermediate",
      "content": "# Essential to know\n- Cookies: 4KB max, sent with every HTTP request\n- HttpOnly: cookie inaccessible in JavaScript (XSS protection)\n- Secure: cookie sent only over HTTPS\n- SameSite: CSRF protection (Strict, Lax, None)\n- Domain and Path: cookie scope\n- Expires/Max-Age: lifetime\n- Cookies vs localStorage for auth: cookies more secure with HttpOnly\n\n---\n\n# Cookies: Complete Guide\n\n## What is a Cookie?\n\nA cookie is a small text file (max 4KB) stored by the browser and sent with EVERY HTTP request to the domain.\n\n**Flow:**\n```\nClient ‚Üí Server: GET /page\nServer ‚Üí Client: Set-Cookie: session=abc123\n\nClient ‚Üí Server: GET /other-page + Cookie: session=abc123\nServer ‚Üí Client: (recognizes client via cookie)\n```\n\n## Creating a Cookie\n",
      "codeExample": "// Secure session management system with cookies\n\n// ========== Session Manager ==========\nconst SessionManager = {\n  SESSION_KEY: 'app_session',\n  USER_KEY: 'app_user',\n  \n  // Create session (called after login)\n  create(sessionToken, user, remember = false) {\n    // Secure cookie for token (sent to server)\n    // Note: In real world, this comes from server with HttpOnly\n    // Here we simulate client-side storage\n    Cookies.set(this.SESSION_KEY, sessionToken, {\n      maxAge: remember ? 86400 * 30 : 86400, // 30d or 1d\n      secure: true,\n      sameSite: 'Strict',\n      path: '/'\n    });\n    \n    // Cookie for user info (not sensitive, accessible in JS)\n    Cookies.set(this.USER_KEY, {\n      id: user.id,\n      name: user.name,\n      avatar: user.avatar\n    }, {\n      maxAge: remember ? 86400 * 30 : 86400\n    });\n    \n    // Trigger event\n    window.dispatchEvent(new Event('auth-change'));\n  },\n  \n  // Get session\n  getToken() {\n    return Cookies.get(this.SESSION_KEY);\n  },\n  \n  getUser() {\n    return Cookies.get(this.USER_KEY);\n  },\n  \n  // Check if logged in\n  isAuthenticated() {\n    return !!this.getToken();\n  },\n  \n  // Logout\n  destroy() {\n    Cookies.remove(this.SESSION_KEY, { path: '/' });\n    Cookies.remove(this.USER_KEY, { path: '/' });\n    window.dispatchEvent(new Event('auth-change'));\n  },\n  \n  // Refresh token\n  refresh(newToken) {\n    const user = this.getUser();\n    const remember = this.getToken()?.length > 0; // Keep same duration\n    this.create(newToken, user, remember);\n  }\n};\n\n\n// ========== API with Auth ==========\nconst API = {\n  async request(url, options = {}) {\n    const token = SessionManager.getToken();\n    \n    const response = await fetch(url, {\n      ...options,\n      headers: {\n        'Content-Type': 'application/json',\n        ...(token && { 'Authorization': `Bearer ${token}` }),\n        ...options.headers\n  ..."
    }
  ],
  "exercises": [
    {
      "id": "storage-ex-1",
      "lessonId": "storage-overview",
      "moduleId": "browser-storage",
      "title": "Browser Storage Quiz",
      "difficulty": "easy",
      "type": "quiz",
      "questions": [
        {
          "question": "What is the approximate maximum size of localStorage?",
          "options": [
            "100KB",
            "5-10MB",
            "50MB",
            "Unlimited"
          ],
          "correctAnswer": 1,
          "explanation": "localStorage is generally limited to about 5-10MB depending on browsers."
        },
        {
          "question": "What is the main difference between localStorage and sessionStorage?",
          "options": [
            "Size",
            "sessionStorage is cleared when tab is closed",
            "Speed",
            "sessionStorage is synchronous"
          ],
          "correctAnswer": 1,
          "explanation": "sessionStorage keeps data only during the session (open tab). localStorage persists until explicit deletion."
        },
        {
          "question": "Why use IndexedDB rather than localStorage for large volumes?",
          "options": [
            "It's simpler",
            "It's asynchronous and supports more data",
            "It's more secure",
            "It's required by law"
          ],
          "correctAnswer": 1,
          "explanation": "IndexedDB is asynchronous (doesn't block UI), supports 50MB+ and allows storing complex objects."
        }
      ]
    },
    {
      "id": "storage-ex-2",
      "lessonId": "local-session-storage",
      "moduleId": "browser-storage",
      "title": "localStorage Practice Quiz",
      "difficulty": "easy",
      "type": "quiz",
      "questions": [
        {
          "question": "How do you store an object in localStorage?",
          "options": [
            "localStorage.setItem('key', object)",
            "localStorage.setItem('key', JSON.stringify(object))",
            "localStorage.save('key', object)",
            "localStorage.object = object"
          ],
          "correctAnswer": 1,
          "explanation": "localStorage only stores strings. You must convert the object with JSON.stringify() and retrieve it with JSON.parse()."
        },
        {
          "question": "Which event allows synchronizing localStorage between tabs?",
          "options": [
            "'localstorage'",
            "'storage'",
            "'sync'",
            "'change'"
          ],
          "correctAnswer": 1,
          "explanation": "The 'storage' event triggers when localStorage is modified in another tab of the same domain."
        },
        {
          "question": "Why shouldn't you store JWT tokens in localStorage?",
          "options": [
            "It's too slow",
            "It's vulnerable to XSS attacks",
            "It won't fit",
            "It's forbidden by browsers"
          ],
          "correctAnswer": 1,
          "explanation": "localStorage is accessible to all JavaScript. In case of XSS attack, an attacker can steal the token. Prefer HttpOnly cookies."
        }
      ]
    },
    {
      "id": "storage-ex-3",
      "lessonId": "indexeddb",
      "moduleId": "browser-storage",
      "title": "IndexedDB Quiz",
      "difficulty": "medium",
      "type": "quiz",
      "questions": [
        {
          "question": "Why use a library like 'idb' with IndexedDB?",
          "options": [
            "To store more",
            "To simplify the complex native API",
            "For security",
            "It's required"
          ],
          "correctAnswer": 1,
          "explanation": "The native IndexedDB API is verbose and event-based. 'idb' provides a modern Promise-based API."
        },
        {
          "question": "What is an 'index' in IndexedDB?",
          "options": [
            "A page number",
            "A structure for fast searching",
            "A table",
            "A primary key"
          ],
          "correctAnswer": 1,
          "explanation": "An index allows fast searching of data by a field other than the primary key."
        },
        {
          "question": "Is IndexedDB synchronous or asynchronous?",
          "options": [
            "Synchronous",
            "Asynchronous",
            "Both",
            "Depends on browser"
          ],
          "correctAnswer": 1,
          "explanation": "IndexedDB is asynchronous, which allows processing large volumes without blocking the user interface."
        }
      ]
    },
    {
      "id": "storage-code-ex-1",
      "lessonId": "local-session-storage",
      "moduleId": "browser-storage",
      "title": "Build a Theme Switcher with localStorage",
      "difficulty": "medium",
      "description": "Use localStorage to persist a user's theme preference across page reloads.",
      "instructions": "Create a `ThemeSwitcher` component that:\n1. Reads the saved theme from `localStorage` key `'theme'` on mount (default to `'light'`)\n2. Has a button that toggles between `'light'` and `'dark'`\n3. Saves the new theme to `localStorage` when toggled\n4. Applies different background and text colors based on theme\n5. Shows the current theme name",
      "starterCode": "function ThemeSwitcher() {\n  // Read initial theme from localStorage\n  // Add state for current theme\n\n  const toggleTheme = () => {\n    // Toggle and save to localStorage\n  };\n\n  return (\n    <div style={{ /* theme-based styles */ }}>\n      <h2>Theme Switcher</h2>\n      <p>Current theme: </p>\n      <button onClick={toggleTheme}>Toggle Theme</button>\n    </div>\n  );\n}",
      "solution": "function ThemeSwitcher() {\n  const [theme, setTheme] = React.useState(\n    () => localStorage.getItem('theme') || 'light'\n  );\n\n  const toggleTheme = () => {\n    const newTheme = theme === 'light' ? 'dark' : 'light';\n    setTheme(newTheme);\n    localStorage.setItem('theme', newTheme);\n  };\n\n  const isDark = theme === 'dark';\n\n  return (\n    <div style={{\n      backgroundColor: isDark ? '#1a1a1a' : '#ffffff',\n      color: isDark ? '#ffffff' : '#1a1a1a',\n      padding: '2rem',\n      borderRadius: '8px',\n      minHeight: '200px'\n    }}>\n      <h2>Theme Switcher</h2>\n      <p>Current theme: {theme}</p>\n      <button onClick={toggleTheme}\n        style={{ padding: '8px 16px', cursor: 'pointer' }}>\n        Toggle Theme\n      </button>\n    </div>\n  );\n}",
      "hints": [
        "Use localStorage.getItem('theme') to read the saved value",
        "Use localStorage.setItem('theme', newTheme) to save",
        "Initialize state with a function: useState(() => localStorage.getItem('theme') || 'light')"
      ],
      "validationPrompt": "Check if the code: 1) Reads initial theme from localStorage 2) Uses useState for theme state 3) Has a toggleTheme function that switches between light/dark 4) Saves to localStorage.setItem when toggling 5) Applies conditional styles based on theme"
    },
    {
      "id": "storage-code-ex-2",
      "lessonId": "local-session-storage",
      "moduleId": "browser-storage",
      "title": "Persistent Note Pad",
      "difficulty": "medium",
      "description": "Build a simple note pad that saves content to localStorage in real-time.",
      "instructions": "Create a `NotePad` component that:\n1. Has a `<textarea>` for writing notes\n2. Loads any previously saved note from `localStorage` key `'note'` on mount\n3. Saves the note to `localStorage` on every change (onChange)\n4. Has a \"Clear\" button that empties the textarea and removes the item from localStorage\n5. Shows a character count below the textarea",
      "starterCode": "function NotePad() {\n  // Load saved note from localStorage\n  // Add state for note text\n\n  const handleChange = (e) => {\n    // Update state and save to localStorage\n  };\n\n  const handleClear = () => {\n    // Clear note and localStorage\n  };\n\n  return (\n    <div>\n      <h2>My Notes</h2>\n      <textarea rows={6} cols={40} />\n      <p>Characters: </p>\n      <button>Clear</button>\n    </div>\n  );\n}",
      "solution": "function NotePad() {\n  const [note, setNote] = React.useState(\n    () => localStorage.getItem('note') || ''\n  );\n\n  const handleChange = (e) => {\n    const value = e.target.value;\n    setNote(value);\n    localStorage.setItem('note', value);\n  };\n\n  const handleClear = () => {\n    setNote('');\n    localStorage.removeItem('note');\n  };\n\n  return (\n    <div>\n      <h2>My Notes</h2>\n      <textarea\n        rows={6}\n        cols={40}\n        value={note}\n        onChange={handleChange}\n        placeholder=\"Write your notes here...\"\n      />\n      <p>Characters: {note.length}</p>\n      <button onClick={handleClear}>Clear</button>\n    </div>\n  );\n}",
      "hints": [
        "Initialize state from localStorage: useState(() => localStorage.getItem('note') || '')",
        "In onChange, update both state and localStorage",
        "Use localStorage.removeItem('note') in the clear handler"
      ],
      "validationPrompt": "Check if the code: 1) Loads initial note from localStorage 2) Has a controlled textarea with value and onChange 3) Saves to localStorage on every change 4) Has a clear button that removes from localStorage 5) Shows character count using note.length"
    }
  ]
}
