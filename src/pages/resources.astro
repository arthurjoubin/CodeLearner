---
import MainLayout from '../layouts/MainLayout.astro';
import { getCollection } from 'astro:content';
import { ArrowRight, Newspaper, Command, Brain, Tag, ExternalLink } from 'lucide-react';

interface NewsItem {
  slug: string;
  data: {
    title: string;
    description: string;
    pubDate: Date;
    tags: string[];
  };
}

interface DevFindItem {
  data: {
    pubDate: Date;
  };
}

interface ToolItem {
  data: {
    name: string;
  };
}

interface LlmItem {
  data: {
    name: string;
  };
}

const news = (await getCollection('news')).sort(
	(a: NewsItem, b: NewsItem) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const latestNews = news.slice(0, 3);

const devfinds = (await getCollection('devfinds')).sort(
	(a: DevFindItem, b: DevFindItem) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const tools = await getCollection('tools') as ToolItem[];
const llms = await getCollection('llms') as LlmItem[];

function formatDate(date: Date) {
	return date.toLocaleDateString('en-US', {
		day: 'numeric',
		month: 'short',
		year: 'numeric'
	});
}

// Provider logos
const providerLogos: Record<string, string> = {
	'Anthropic': 'https://avatars.githubusercontent.com/u/76263028?s=200&v=4',
	'OpenAI': 'https://avatars.githubusercontent.com/u/14957082?s=200&v=4',
	'Google': 'https://raw.githubusercontent.com/github/explore/main/topics/google/google.png',
	'DeepSeek': 'https://avatars.githubusercontent.com/u/148330874?s=200&v=4',
};

// Tool logos
const toolLogos: Record<string, string> = {
	'Cursor': 'https://avatars.githubusercontent.com/u/126825580?s=200&v=4',
	'Claude Code': 'https://avatars.githubusercontent.com/u/76263028?s=200&v=4',
	'V0': 'https://avatars.githubusercontent.com/u/14985020?s=200&v=4',
	'Lovable': 'https://lovable.dev/favicon.ico',
	'Bolt.new': 'https://bolt.new/favicon.svg',
};

function getProviderLogo(provider: string): string {
	return providerLogos[provider] || `https://ui-avatars.com/api/?name=${encodeURIComponent(provider)}&background=random&color=fff&size=128`;
}

function getToolLogo(toolName: string): string {
	return toolLogos[toolName] || `https://ui-avatars.com/api/?name=${encodeURIComponent(toolName)}&background=random&color=fff&size=128`;
}
---

<MainLayout title="Resources">
	<div class="page-enter">
		<div class="mb-6">
			<div class="relative inline-block group">
				<h1 class="text-2xl font-black text-gray-900 uppercase">Resources</h1>
				<span class="absolute -bottom-0.5 left-0 w-12 h-0.5 bg-primary-500 transition-all group-hover:w-full duration-300" />
			</div>
			<p class="text-gray-700 mt-1">AI news, tools, models, and Dev Finds</p>
		</div>

		<div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8 p-1">
			<a
				href="/resources/news"
				class="group border-2 border-gray-300 rounded-lg p-4 transition-all hover:border-primary-500 hover:shadow-md bg-white relative"
			>
				<div class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity">
					<ExternalLink class="w-4 h-4 text-gray-400" />
				</div>
				<div class="flex items-center gap-3 mb-3">
					<div class="w-10 h-10 bg-primary-100 flex items-center justify-center rounded-lg">
						<Newspaper class="w-5 h-5 text-primary-700" />
					</div>
					<div class="flex-1">
						<h3 class="font-bold text-gray-900 uppercase text-sm group-hover:text-primary-700 transition-colors">Latest News</h3>
					</div>
				</div>
				<p class="text-xs text-gray-700 ml-0">{news.length} articles</p>
			</a>

			<a
				href="/resources/tools"
				class="group border-2 border-gray-300 rounded-lg p-4 transition-all hover:border-primary-500 hover:shadow-md bg-white relative"
			>
				<div class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity">
					<ExternalLink class="w-4 h-4 text-gray-400" />
				</div>
				<div class="flex items-center gap-3 mb-3">
					<div class="w-10 h-10 bg-primary-100 flex items-center justify-center rounded-lg">
						<Command class="w-5 h-5 text-primary-700" />
					</div>
					<div class="flex-1">
						<h3 class="font-bold text-gray-900 uppercase text-sm group-hover:text-primary-700 transition-colors">AI Tools</h3>
					</div>
				</div>
				<p class="text-xs text-gray-700 ml-0">{tools.length} tools</p>
			</a>

			<a
				href="/resources/llms"
				class="group border-2 border-gray-300 rounded-lg p-4 transition-all hover:border-primary-500 hover:shadow-md bg-white relative"
			>
				<div class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity">
					<ExternalLink class="w-4 h-4 text-gray-400" />
				</div>
				<div class="flex items-center gap-3 mb-3">
					<div class="w-10 h-10 bg-primary-100 flex items-center justify-center rounded-lg">
						<Brain class="w-5 h-5 text-primary-700" />
					</div>
					<div class="flex-1">
						<h3 class="font-bold text-gray-900 uppercase text-sm group-hover:text-primary-700 transition-colors">LLM Models</h3>
					</div>
				</div>
				<p class="text-xs text-gray-700 ml-0">{llms.length} models</p>
			</a>

			<a
				href="/resources/devfinds"
				class="group border-2 border-gray-300 rounded-lg p-4 transition-all hover:border-primary-500 hover:shadow-md bg-white relative"
			>
				<div class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity">
					<ExternalLink class="w-4 h-4 text-gray-400" />
				</div>
				<div class="flex items-center gap-3 mb-3">
					<div class="w-10 h-10 bg-primary-100 flex items-center justify-center rounded-lg">
						<Tag class="w-5 h-5 text-primary-700" />
					</div>
					<div class="flex-1">
						<h3 class="font-bold text-gray-900 uppercase text-sm group-hover:text-primary-700 transition-colors">Dev Finds</h3>
					</div>
				</div>
				<p class="text-xs text-gray-700 ml-0">{devfinds.length} active</p>
			</a>
		</div>

		<div class="mb-8">
			<div class="flex items-center justify-between mb-4">
				<div class="relative inline-block group">
					<h2 class="font-bold text-gray-900 uppercase text-lg">Latest News</h2>
					<span class="absolute -bottom-0.5 left-0 w-10 h-0.5 bg-primary-500 transition-all group-hover:w-full duration-300" />
				</div>
				<a href="/resources/news" class="text-xs font-bold uppercase text-primary-600 hover:text-primary-700 transition-colors flex items-center gap-1">
					View all
					<ArrowRight class="w-3 h-3" />
				</a>
			</div>
			
			<div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3 p-1">
				{latestNews.map((article: typeof news[0], index: number) => (
					<a
						href={`/resources/news/${article.slug}`}
						class="group border-2 border-gray-300 rounded-lg p-4 transition-all hover:border-primary-500 hover:shadow-md bg-white relative"
						style={`animation-delay: ${index * 50}ms`}
					>
						<div class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity">
							<ExternalLink class="w-4 h-4 text-gray-400" />
						</div>

						<div class="flex items-center gap-2 mb-2">
							<span class="text-[10px] px-2 py-0.5 bg-gray-100 text-gray-600 rounded font-bold uppercase">
								{article.data.tags[0]}
							</span>
							<span class="text-[10px] text-gray-500">{formatDate(article.data.pubDate)}</span>
						</div>
						
						<div class="flex items-center gap-2 mb-1">
							<div class="w-2 h-2 bg-primary-500 rounded-full group-hover:scale-150 transition-transform" />
							<h3 class="font-bold text-gray-900 group-hover:text-primary-700 transition-colors text-sm line-clamp-1">
								{article.data.title}
							</h3>
						</div>
						
						<p class="text-xs text-gray-700 ml-4 line-clamp-2">{article.data.description}</p>
					</a>
				))}
			</div>
		</div>
	</div>
</MainLayout>

<style>
	.line-clamp-1 {
		display: -webkit-box;
		-webkit-line-clamp: 1;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>
