---
import MainLayout from '../../layouts/MainLayout.astro';
import PageTitle from '../../components/PageTitle.astro';
import { supportedLanguages, getExercisesByLanguage } from '../../data/language-exercises';
import CodeCraftExerciseList from '../../components/CodeCraftExerciseList';

const { language: languageId } = Astro.params;
const language = supportedLanguages.find(lang => lang.id === languageId);
const exercises = language ? getExercisesByLanguage(language.id).sort((a, b) => a.order - b.order) : [];

if (!language) {
  return Astro.redirect('/codecraft');
}
---

<MainLayout title={`${language.name} - CodeCraft Exercises`}>
  <div class="page-enter">
    <!-- Breadcrumb -->
    <nav class="flex items-center gap-1 text-xs font-bold mb-2">
      <a href="/codecraft" class="text-gray-700 hover:text-primary-600 transition-colors uppercase">CodeCraft</a>
      <svg class="w-3 h-3 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
      <span class="text-gray-800 uppercase">{language.name}</span>
    </nav>

    <!-- Header -->
    <div class="mb-8">
      <div class="flex items-center gap-4 mb-3">
        <div 
          class="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl"
          style={`background-color: ${language.color}15`}
        >
          {language.icon}
        </div>
        <div>
          <PageTitle>
            <h1 slot="title" class="text-2xl font-black text-gray-900 uppercase">{language.name}</h1>
          </PageTitle>
          <p class="text-gray-600">{exercises.length} exercises to master {language.name}</p>
        </div>
      </div>
    </div>

    <!-- Exercise List (React Island with progress) -->
    <CodeCraftExerciseList client:load exercises={exercises} language={language} />

    <!-- Practice Mode Card -->
    <a
      href={`/codecraft/practice/${language.id}`}
      class="mt-6 block border-2 border-dashed border-primary-300 bg-primary-50/50 rounded-lg p-4 hover:bg-primary-50 hover:border-primary-400 transition-colors group"
    >
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center flex-shrink-0 group-hover:bg-primary-200 transition-colors">
          <svg class="w-5 h-5 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
        </div>
        <div class="flex-1">
          <h3 class="font-bold text-gray-900">Generate Practice Exercise</h3>
          <p class="text-sm text-gray-600">AI-powered exercises with unlimited generation</p>
        </div>
        <svg class="w-5 h-5 text-primary-400 group-hover:text-primary-600 group-hover:translate-x-1 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </div>
    </a>

    <!-- Back to languages -->
    <a 
      href="/codecraft" 
      class="mt-8 inline-flex items-center gap-2 text-xs font-bold uppercase text-gray-700 hover:text-gray-900 transition-colors"
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Back to languages
    </a>
  </div>
</MainLayout>
