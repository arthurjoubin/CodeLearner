---
import MainLayout from '../../layouts/MainLayout.astro';
import { getCollection } from 'astro:content';
import ResourceTabs from '../../components/ResourceTabs.astro';
import { ArrowLeft, ExternalLink } from 'lucide-react';

const tools = await getCollection('tools');
const toolsByCategory = tools.reduce((acc: Record<string, typeof tools>, tool: typeof tools[0]) => {
	const cat = tool.data.category;
	if (!acc[cat]) acc[cat] = [];
	acc[cat].push(tool);
	return acc;
}, {} as Record<string, typeof tools>);

const categories = Object.keys(toolsByCategory).sort();
const totalTools = tools.length;

// Tool logos from official sources or GitHub topics
const toolLogos: Record<string, string> = {
	'Cursor': 'https://avatars.githubusercontent.com/u/126825580?s=200&v=4',
	'Claude Code': 'https://avatars.githubusercontent.com/u/76263028?s=200&v=4',
	'V0': 'https://avatars.githubusercontent.com/u/14985020?s=200&v=4',
	'Lovable': 'https://lovable.dev/favicon.ico',
	'Bolt.new': 'https://ui-avatars.com/api/?name=Bolt&background=0D8ABC&color=fff&size=128',
};

function getToolLogo(toolName: string): string {
	return toolLogos[toolName] || `https://ui-avatars.com/api/?name=${encodeURIComponent(toolName)}&background=random&color=fff&size=128`;
}

// Format pricing text to be more condensed
function formatPricing(pricing: string): string {
	if (pricing.toLowerCase().includes('free')) {
		if (pricing.toLowerCase().includes('$20')) return 'Free / $20';
		if (pricing.toLowerCase().includes('$10')) return 'Free / $10';
		if (pricing.toLowerCase().includes('$15')) return 'Free / $15';
		if (pricing.toLowerCase().includes('pro')) return 'Free / Pro';
		return 'Free';
	}
	if (pricing.toLowerCase().includes('vercel')) return 'Vercel';
	return pricing;
}
---

<MainLayout title="AI Tools">
	<div class="page-enter">
		<div class="relative inline-block group mb-4">
			<a href="/resources" class="inline-flex items-center gap-2 text-gray-800 font-bold uppercase hover:text-primary-600 transition-colors text-sm">
				<ArrowLeft className="w-4 h-4" /> Back
			</a>
			<span class="absolute -bottom-0.5 left-0 w-0 h-0.5 bg-primary-500 transition-all group-hover:w-20 duration-200" />
		</div>

		<div class="mb-6">
			<div class="relative inline-block group">
				<div class="flex items-center gap-2">
					<h1 class="text-2xl font-black text-gray-900 uppercase">AI Tools</h1>
					<span class="px-2 py-1 bg-gray-100 text-gray-600 text-[10px] font-bold uppercase tracking-wider border border-gray-300 rounded">
						{totalTools} tools
					</span>
				</div>
				<span class="absolute -bottom-0.5 left-0 w-12 h-0.5 bg-primary-500 transition-all group-hover:w-full duration-300" />
			</div>
			<p class="text-gray-700 mt-1">Essential AI-powered development tools across {categories.length} categories</p>
		</div>

		<ResourceTabs active="tools" />

		<div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3 p-1">
			{tools.map((tool: typeof tools[0], index: number) => {
				const toolSlug = tool.slug;
				const logoUrl = getToolLogo(tool.data.name);
				return (
					<a
						href={`/resources/tools/${toolSlug}`}
						class="border-2 border-gray-300 rounded-lg p-4 transition-all hover:border-primary-500 hover:shadow-md bg-white relative group"
						style={`animation-delay: ${index * 50}ms`}
					>
						<div class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity">
							<ExternalLink className="w-4 h-4 text-gray-400" />
						</div>

						<div class="absolute top-3 right-3">
							<span class="text-[8px] px-2 py-0.5 bg-green-100 text-green-700 rounded-full font-bold uppercase">
								{formatPricing(tool.data.pricing)}
							</span>
						</div>

						<div class="flex items-center gap-3 mb-3">
							<div class="w-10 h-10 rounded-lg overflow-hidden bg-white border border-gray-200 flex items-center justify-center shrink-0">
								<img src={logoUrl} alt={tool.data.name} class="w-8 h-8 object-contain" />
							</div>
							<div class="flex items-center gap-2 pr-16">
								<div class="w-2 h-2 bg-primary-500 rounded-full group-hover:scale-150 transition-transform" />
								<h3 class="font-bold text-gray-900 uppercase group-hover:text-primary-700 transition-colors">{tool.data.name}</h3>
							</div>
						</div>
						
						<p class="text-xs text-gray-700 line-clamp-3">{tool.data.description}</p>
					</a>
				);
			})}
		</div>
	</div>
</MainLayout>
