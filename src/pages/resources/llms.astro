---
import MainLayout from '../../layouts/MainLayout.astro';
import { getCollection } from 'astro:content';

const llms = await getCollection('llms');
const llmsByProvider = llms.reduce((acc, llm) => {
	const provider = llm.data.provider;
	if (!acc[provider]) acc[provider] = [];
	acc[provider].push(llm);
	return acc;
}, {} as Record<string, typeof llms>);

const providers = Object.keys(llmsByProvider).sort();
---

<MainLayout title="LLM Models">
	<div class="page-enter max-w-5xl mx-auto">
		<div class="mb-4">
			<a href="/resources" class="text-xs text-gray-500 hover:text-primary-600 uppercase font-bold flex items-center gap-1 mb-3">
				<span class="w-1.5 h-1.5 bg-primary-500 rounded-full" />
				Back to Resources
			</a>
			<div class="flex items-center justify-between">
				<div class="relative inline-block">
					<h1 class="text-xl font-black text-gray-900 uppercase">LLM Models</h1>
					<span class="absolute -bottom-0.5 left-0 w-12 h-0.5 bg-primary-500" />
				</div>
				<div class="flex gap-2 text-xs">
					<a href="/resources/tools" class="px-2 py-1 border border-gray-300 rounded hover:bg-gray-100 transition-colors">Tools</a>
					<a href="/resources/news" class="px-2 py-1 border border-gray-300 rounded hover:bg-gray-100 transition-colors">News</a>
					<a href="/resources/deals" class="px-2 py-1 border border-gray-300 rounded hover:bg-gray-100 transition-colors">Deals</a>
				</div>
			</div>
			<p class="text-sm text-gray-500 mt-1">{llms.length} models from {providers.length} providers</p>
		</div>

		<table class="w-full text-sm">
			<thead>
				<tr class="border-b-2 border-gray-300">
					<th class="text-left py-2 px-3 font-bold text-gray-700 uppercase text-xs">Model</th>
					<th class="text-left py-2 px-3 font-bold text-gray-700 uppercase text-xs">Provider</th>
					<th class="text-left py-2 px-3 font-bold text-gray-700 uppercase text-xs">Context</th>
					<th class="text-left py-2 px-3 font-bold text-gray-700 uppercase text-xs">HumanEval</th>
					<th class="text-left py-2 px-3 font-bold text-gray-700 uppercase text-xs">Pricing</th>
				</tr>
			</thead>
			<tbody>
				{llms.map((llm) => {
					const llmSlug = llm.slug;
					const humanEval = llm.data.benchmarks?.find(b => b.name === 'HumanEval')?.score;
					return (
						<tr class="border-b border-gray-200 hover:bg-gray-50">
							<td class="py-2 px-3">
								<a href={`/resources/llms/${llmSlug}`} class="font-bold text-gray-900 hover:text-primary-600">{llm.data.name}</a>
							</td>
							<td class="py-2 px-3 text-gray-600">{llm.data.provider}</td>
							<td class="py-2 px-3 text-gray-600">{llm.data.contextWindow}</td>
							<td class="py-2 px-3 font-bold text-gray-900">{humanEval || '-'}</td>
							<td class="py-2 px-3 text-gray-600">{llm.data.pricing.split(' ')[0]}</td>
						</tr>
					);
				})}
			</tbody>
		</table>
	</div>
</MainLayout>
