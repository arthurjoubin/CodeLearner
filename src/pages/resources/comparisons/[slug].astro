---
import MainLayout from '../../../layouts/MainLayout.astro';
import PageTitle from '../../../components/PageTitle.astro';
import { getEntry } from 'astro:content';

const { slug } = Astro.params;
const comp = await getEntry('comparisons', slug!);

if (!comp) {
	return Astro.redirect('/resources');
}

const { Content } = await comp.render();

function formatDate(date: Date) {
	return date.toLocaleDateString('en-US', {
		day: 'numeric',
		month: 'long',
		year: 'numeric'
	});
}
---

<MainLayout title={comp.data.title}>
	<div class="page-enter max-w-3xl mx-auto">
		<a
			href="/resources"
			class="inline-flex items-center gap-1 text-xs font-bold text-gray-600 hover:text-primary-600 transition-colors mb-4"
		>
			<span class="w-2 h-2 bg-primary-500 rounded-full" />
			Back to resources
		</a>

				<article>
			<header class="mb-6">
				<div class="flex flex-wrap items-center gap-2 mb-3">
					{comp.data.tools.map((tool: any) => (
						<span class="text-[10px] px-2 py-0.5 bg-gray-900 text-white rounded border border-gray-700 uppercase font-bold">
							{tool}
						</span>
					))}
				</div>
				<PageTitle>
					<h1 slot="title" class="text-2xl font-black text-gray-900 uppercase leading-tight">{comp.data.title}</h1>
				</PageTitle>
				<p class="text-gray-600 mt-2 text-sm">{comp.data.description}</p>
				<div class="flex items-center gap-3 mt-3 text-xs text-gray-600">
					<span>{formatDate(comp.data.pubDate)}</span>
				</div>
			</header>

			{comp.data.image && (
				<img
					src={comp.data.image}
					alt={comp.data.title}
					class="w-full h-48 object-cover rounded-lg border-2 border-gray-300 mb-6"
				/>
			)}

			<div class="bg-primary-50 border-2 border-primary-200 rounded-lg p-4 mb-6">
				<p class="text-sm font-bold text-primary-900 mb-1">Our verdict</p>
				<p class="text-primary-700 italic">"{comp.data.verdict}"</p>
			</div>

			<div class="prose prose-sm max-w-none prose-headings:font-bold prose-headings:text-gray-900 prose-a:text-primary-600 prose-a:no-underline hover:prose-a:underline prose-strong:text-gray-900 prose-strong:font-bold prose-code:bg-gray-100 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-primary-700 prose-code:font-mono prose-pre:bg-gray-900 prose-pre:text-gray-100">
				<Content />
			</div>
		</article>

		<div class="mt-8 pt-6 border-t-2 border-gray-200">
			<p class="text-sm text-gray-600">
				Was this information helpful? Explore our other comparisons!
			</p>
		</div>
	</div>
</MainLayout>
