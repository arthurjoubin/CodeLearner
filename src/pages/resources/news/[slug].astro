---
import MainLayout from '../../../layouts/MainLayout.astro';
import { getCollection, getEntry } from 'astro:content';
import { ArrowLeft, ArrowRight } from 'lucide-react';

export async function getStaticPaths() {
	const news = await getCollection('news');
	return news.map(post => ({
		params: { slug: post.slug },
		props: { slug: post.slug },
	}));
}

const { slug } = Astro.params;
const post = await getEntry('news', slug!);

if (!post) {
	return Astro.redirect('/resources/news');
}

const { Content } = await post.render();

const tools = await getCollection('tools');
const llms = await getCollection('llms');

function formatDate(date: Date) {
	return date.toLocaleDateString('en-US', {
		day: 'numeric',
		month: 'long',
		year: 'numeric'
	});
}

function getToolPath(toolName: string) {
	const isLlm = llms.some(l => l.data.name === toolName);
	const s = toolName.toLowerCase().replace(/\s+/g, '-');
	return isLlm ? `/resources/llms/${s}` : `/resources/tools/${s}`;
}
---

<MainLayout title={post.data.title}>
	<div class="page-enter max-w-5xl mx-auto">
		<div class="flex items-center gap-2 mb-4 text-xs uppercase font-bold">
			<a href="/resources" class="text-gray-500 hover:text-primary-600">Resources</a>
			<span class="text-gray-300">/</span>
			<a href="/resources/news" class="text-gray-500 hover:text-primary-600">News</a>
			<span class="text-gray-300">/</span>
			<span class="text-gray-900 truncate max-w-[150px]">{post.data.title}</span>
		</div>

		<div class="bg-white border-2 border-gray-300 rounded-lg overflow-hidden mb-4">
			<div class="p-4 border-b-2 border-gray-200">
				<div class="flex items-center gap-2 mb-2">
					{post.data.tags.map((tag) => (
						<span class="text-[10px] px-2 py-0.5 bg-gray-100 text-gray-600 rounded font-bold uppercase">{tag}</span>
					))}
				</div>
				<h1 class="font-bold text-xl text-gray-900 leading-tight mb-2">{post.data.title}</h1>
				<div class="text-xs text-gray-500">
					<span class="font-medium text-gray-700">{post.data.author}</span>
					<span class="mx-2">Â·</span>
					<span>{formatDate(post.data.pubDate)}</span>
				</div>
			</div>

			{post.data.mentionedTools && post.data.mentionedTools.length > 0 && (
				<div class="px-4 py-2 bg-gray-50 border-b-2 border-gray-200 flex items-center gap-2">
					<span class="text-[10px] font-bold uppercase text-gray-500">Mentioned:</span>
					<div class="flex flex-wrap gap-1">
						{post.data.mentionedTools.map(toolName => {
							const isLlm = llms.some(l => l.data.name === toolName);
							return (
								<a href={getToolPath(toolName)} class="text-[10px] px-2 py-0.5 bg-white border border-gray-300 rounded font-bold uppercase hover:border-gray-900 transition-colors">
									{toolName}
								</a>
							);
						})}
					</div>
				</div>
			)}

			<div class="p-4">
				<div class="prose prose-sm max-w-none prose-headings:font-bold prose-headings:text-gray-900 prose-a:text-primary-600 prose-a:no-underline hover:prose-a:underline prose-strong:text-gray-900 prose-strong:font-bold prose-code:bg-gray-100 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-primary-700 prose-code:font-mono prose-pre:bg-gray-900 prose-pre:text-gray-100 prose-pre:rounded-lg prose-pre:p-3">
					<Content />
				</div>
			</div>
		</div>

		<div class="flex items-center gap-2 text-xs">
			<a href="/resources/news" class="px-3 py-1.5 bg-gray-900 text-white rounded font-bold uppercase hover:bg-gray-800 transition-colors flex items-center gap-1">
				<ArrowLeft class="w-3 h-3" />
				News
			</a>
			<a href="/resources/tools" class="px-3 py-1.5 border border-gray-300 rounded font-bold uppercase hover:bg-gray-100 transition-colors">Tools</a>
			<a href="/resources/llms" class="px-3 py-1.5 border border-gray-300 rounded font-bold uppercase hover:bg-gray-100 transition-colors">LLMs</a>
			<a href="/resources/devfinds" class="px-3 py-1.5 border border-gray-300 rounded font-bold uppercase hover:bg-gray-100 transition-colors">Dev Finds</a>
		</div>
	</div>
</MainLayout>
