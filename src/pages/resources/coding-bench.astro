---
import MainLayout from '../../layouts/MainLayout.astro';
import PageTitle from '../../components/PageTitle.astro';
import ResourceTabs from '../../components/ResourceTabs.astro';
import { ArrowLeft, TrendingUp, Trophy, Calendar, ChevronUp, ChevronDown } from 'lucide-react';

// All models with their benchmark data - now with llmSlug to link to LLM pages
const allModels = [
  { family: 'Anthropic', version: 'Claude 4.5 Opus', date: 'Jan 2026', score: 80.9, role: 'Current World SOTA.', current: true, llmSlug: 'claude-4-5' },
  { family: 'OpenAI', version: 'GPT-5.2 Codex', date: 'Dec 2025', score: 80.0, role: 'Top competitor to Opus.', current: true, llmSlug: 'codex-5-2' },
  { family: 'Google', version: 'Gemini 3.0 Flash', date: 'Dec 2025', score: 78.0, role: 'Extreme speed / High score.', current: true, llmSlug: 'gemini-3' },
  { family: 'Anthropic', version: 'Claude 4.5 Sonnet', date: 'Oct 2025', score: 77.2, role: 'Current developer standard.', current: true, llmSlug: 'claude-4-5' },
  { family: 'Moonshot AI', version: 'Kimi K2.5', date: 'Jan 2026', score: 76.8, role: 'Agent Swarm architecture.', current: true, llmSlug: 'kimi-k2-5' },
  { family: 'OpenAI', version: 'GPT-5.1 Codex', date: 'Aug 2025', score: 76.3, role: 'Multi-file optimization.' },
  { family: 'Google', version: 'Gemini 3.0 Pro', date: 'Oct 2025', score: 76.2, role: 'Native multimodal.', current: true, llmSlug: 'gemini-3' },
  { family: 'MiniMax', version: 'MiniMax 2.1 (REAP)', date: 'Nov 2025', score: 74.0, role: 'C++ / Rust / Go specialist.', current: true, llmSlug: 'minimax-2-1' },
  { family: 'Zhipu AI', version: 'GLM 4.7', date: 'Dec 2025', score: 73.8, role: 'Current bilingual flagship.', current: true, llmSlug: 'glm-4-7' },
  { family: 'DeepSeek', version: 'DeepSeek V3.2', date: 'Dec 2025', score: 73.1, role: 'Current Open-Weights champion.', current: true, llmSlug: 'deepseek-3-2' },
  { family: 'Anthropic', version: 'Claude 4.0 Sonnet', date: 'May 2025', score: 72.7, role: 'Transition to v4 architecture.', current: true, llmSlug: 'claude-4-5' },
  { family: 'OpenAI', version: 'o3 (Full Reasoning)', date: 'Dec 2024', score: 71.7, role: 'Pioneer of long reasoning.' },
  { family: 'Moonshot AI', version: 'Kimi K2', date: 'Jan 2025', score: 71.3, role: 'Pure reasoning.' },
  { family: 'OpenAI', version: 'GPT-5.0 Codex', date: 'May 2025', score: 71.0, role: 'First GPT-5 Code version.' },
  { family: 'Anthropic', version: 'Claude 3.7 Sonnet', date: 'Feb 2025', score: 70.3, role: 'First "Thinking" mode.', current: true, llmSlug: 'claude-4-5' },
  { family: 'Anthropic', version: 'Claude 4.1 Opus', date: 'Sept 2025', score: 70.8, role: 'Complex reasoning (Heavy).', current: true, llmSlug: 'claude-4-5' },
  { family: 'DeepSeek', version: 'DeepSeek V3.1', date: 'Aug 2025', score: 66.0, role: 'Major Agents update.', current: true, llmSlug: 'deepseek-3-2' },
  { family: 'OpenAI', version: 'GPT-4.1 Codex', date: 'Feb 2025', score: 66.5, role: '"Code Agent" specialization.' },
  { family: 'Zhipu AI', version: 'GLM 4.6', date: 'Oct 2025', score: 68.0, role: 'Advanced bug fixing.', current: true, llmSlug: 'glm-4-7' },
  { family: 'Anthropic', version: 'Claude 4.5 Haiku', date: 'Nov 2025', score: 68.8, role: 'Unbeatable Performance/Price.', current: true, llmSlug: 'claude-4-5' },
  { family: 'MiniMax', version: 'MiniMax 2.0', date: 'June 2025', score: 69.4, role: 'Stable and efficient.', current: true, llmSlug: 'minimax-2-1' },
  { family: 'Google', version: 'Gemini 2.5 Pro', date: 'Mar 2025', score: 59.6, role: 'Context king (2M+).', current: true, llmSlug: 'gemini-3' },
  { family: 'Zhipu AI', version: 'GLM 4.5', date: 'Aug 2025', score: 51.2, role: 'Entry into agentic era.', current: true, llmSlug: 'glm-4-7' },
  { family: 'DeepSeek', version: 'DeepSeek R1', date: 'Jan 2025', score: 49.2, role: 'Reasoning specialist (RL).', current: true, llmSlug: 'deepseek-3-2' },
  { family: 'DeepSeek', version: 'DeepSeek V3', date: 'Dec 2024', score: 49.0, role: 'Performant MoE base.', current: true, llmSlug: 'deepseek-3-2' },
  { family: 'Anthropic', version: 'Claude 3.6 Sonnet', date: 'Oct 2024', score: 54.2, role: 'Computer Use improvement.', current: true, llmSlug: 'claude-4-5' },
  { family: 'Anthropic', version: 'Claude 3.5 Sonnet', date: 'June 2024', score: 49.0, role: 'The legend (starting point).', current: true, llmSlug: 'claude-4-5' },
];

const familyColors: Record<string, string> = {
  'Anthropic': 'border-yellow-400 bg-yellow-50',
  'OpenAI': 'border-blue-400 bg-blue-50',
  'DeepSeek': 'border-purple-400 bg-purple-50',
  'Google': 'border-red-400 bg-red-50',
  'Zhipu AI': 'border-pink-400 bg-pink-50',
  'Moonshot AI': 'border-cyan-400 bg-cyan-50',
  'MiniMax': 'border-indigo-400 bg-indigo-50',
};

const getRankColor = (index: number) => {
  if (index === 0) return 'text-yellow-500';
  if (index === 1) return 'text-gray-400';
  if (index === 2) return 'text-orange-400';
  return 'text-gray-500';
};

// Parse date string like "Jan 2026" to a sortable format
function parseDate(dateStr: string): number {
  const months: Record<string, number> = {
    'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'June': 5,
    'July': 6, 'Aug': 7, 'Sept': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11
  };
  const [month, year] = dateStr.split(' ');
  return parseInt(year) * 12 + (months[month] || 0);
}
---

<MainLayout title="Coding Bench - LLM Rankings">
  <div class="page-enter">
    <div class="relative inline-block group mb-4">
      <a href="/resources" class="inline-flex items-center gap-2 text-gray-800 font-bold uppercase hover:text-primary-600 transition-colors text-sm">
        <ArrowLeft className="w-4 h-4" /> Back
      </a>
      <span class="absolute -bottom-0.5 left-0 w-0 h-0.5 bg-primary-500 transition-all group-hover:w-20 duration-200" />
    </div>

    <div class="mb-6">
      <PageTitle>
        <h1 slot="title" class="text-2xl font-black text-gray-900 uppercase">Coding Bench</h1>
        <span slot="tag" class="px-2 py-1 bg-gray-100 text-gray-600 text-[10px] font-bold uppercase tracking-wider border border-gray-300 rounded">
          <TrendingUp class="w-3 h-3 inline mr-1" />SWE-Bench
        </span>
      </PageTitle>
      <p class="text-gray-700 mt-1">Model progression on SWE-Bench Verified benchmark</p>
    </div>

    <ResourceTabs active="coding-bench" />

    <!-- Sort Controls -->
    <div class="flex flex-wrap items-center gap-3 mb-4">
      <span class="text-sm font-bold text-gray-600 uppercase">Sort by:</span>
      <div class="flex items-center gap-2">
        <button 
          id="sort-score-desc"
          class="sort-btn flex items-center gap-1 px-3 py-1.5 text-xs font-bold uppercase bg-gray-900 text-white rounded hover:bg-gray-700 transition-colors"
          data-sort="score"
          data-order="desc"
        >
          <TrendingUp className="w-3 h-3" />
          Score
          <ChevronDown className="w-3 h-3" />
        </button>
        <button 
          id="sort-score-asc"
          class="sort-btn flex items-center gap-1 px-3 py-1.5 text-xs font-bold uppercase bg-gray-100 text-gray-600 border border-gray-300 rounded hover:bg-gray-200 transition-colors"
          data-sort="score"
          data-order="asc"
        >
          <TrendingUp className="w-3 h-3" />
          Score
          <ChevronUp className="w-3 h-3" />
        </button>
        <button 
          id="sort-date-desc"
          class="sort-btn flex items-center gap-1 px-3 py-1.5 text-xs font-bold uppercase bg-gray-100 text-gray-600 border border-gray-300 rounded hover:bg-gray-200 transition-colors"
          data-sort="date"
          data-order="desc"
        >
          <Calendar className="w-3 h-3" />
          Date
          <ChevronDown className="w-3 h-3" />
        </button>
        <button 
          id="sort-date-asc"
          class="sort-btn flex items-center gap-1 px-3 py-1.5 text-xs font-bold uppercase bg-gray-100 text-gray-600 border border-gray-300 rounded hover:bg-gray-200 transition-colors"
          data-sort="date"
          data-order="asc"
        >
          <Calendar className="w-3 h-3" />
          Date
          <ChevronUp className="w-3 h-3" />
        </button>
      </div>
    </div>

    <div class="bg-white border-2 border-gray-300 rounded-lg overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full" id="models-table">
          <thead>
            <tr class="bg-gray-50 border-b-2 border-gray-300">
              <th class="px-4 py-3 text-left text-xs font-bold uppercase text-gray-600">Rank</th>
              <th class="px-4 py-3 text-left text-xs font-bold uppercase text-gray-600">Family</th>
              <th class="px-4 py-3 text-left text-xs font-bold uppercase text-gray-600">Model</th>
              <th class="px-4 py-3 text-left text-xs font-bold uppercase text-gray-600">Date</th>
              <th class="px-4 py-3 text-left text-xs font-bold uppercase text-gray-600">Evolution</th>
              <th class="px-4 py-3 text-right text-xs font-bold uppercase text-gray-600">Score</th>
            </tr>
          </thead>
          <tbody id="models-tbody">
            {allModels.sort((a, b) => b.score - a.score).map((model, index) => (
              <tr class={`border-b border-gray-200 hover:bg-gray-50 transition-colors ${model.current ? 'bg-gray-50/50' : ''}`} data-score={model.score} data-date={parseDate(model.date)}>
                <td class="px-4 py-3">
                  <div class="flex items-center gap-2">
                    {index < 3 && (
                      <Trophy className={`w-4 h-4 ${getRankColor(index)}`} />
                    )}
                    <span class={`font-bold ${getRankColor(index)} rank-number`}>#{index + 1}</span>
                  </div>
                </td>
                <td class="px-4 py-3">
                  <span class={`inline-block px-2 py-1 text-[10px] font-bold uppercase rounded border ${familyColors[model.family]}`}>
                    {model.family}
                  </span>
                </td>
                <td class="px-4 py-3">
                  <div class="flex items-center gap-2">
                    {model.llmSlug ? (
                      <a 
                        href={`/resources/llms/${model.llmSlug}`}
                        class={`font-semibold text-sm ${model.current ? 'text-primary-700' : 'text-gray-900'} hover:text-primary-600 hover:underline transition-colors`}
                      >
                        {model.version}
                      </a>
                    ) : (
                      <span class={`font-semibold text-sm ${model.current ? 'text-primary-700' : 'text-gray-900'}`}>
                        {model.version}
                      </span>
                    )}
                    {model.current && (
                      <span class="text-[8px] px-1.5 py-0.5 bg-green-500 text-white rounded-full font-bold">CURRENT</span>
                    )}
                  </div>
                </td>
                <td class="px-4 py-3 text-sm text-gray-600">{model.date}</td>
                <td class="px-4 py-3 text-sm text-gray-600">{model.role}</td>
                <td class="px-4 py-3 text-right">
                  <span class={`font-bold text-lg ${index < 3 ? 'text-green-600' : 'text-gray-700'} score-display`}>
                    {model.score.toFixed(1)}%
                  </span>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>

    <div class="mt-8 grid md:grid-cols-3 gap-4">
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
        <div class="flex items-center gap-2 mb-2">
          <Trophy className="w-5 h-5 text-yellow-500" />
          <h3 class="font-bold text-gray-900 uppercase text-sm">Top 3 Leaders</h3>
        </div>
        <div class="space-y-1">
          <p class="text-xs text-gray-700"><span class="font-bold">1.</span> Claude 4.5 Opus - 80.9%</p>
          <p class="text-xs text-gray-700"><span class="font-bold">2.</span> GPT-5.2 Codex - 80.0%</p>
          <p class="text-xs text-gray-700"><span class="font-bold">3.</span> Gemini 3.0 Flash - 78.0%</p>
        </div>
      </div>

      <div class="bg-green-50 border border-green-200 rounded-lg p-4">
        <h3 class="font-bold text-gray-900 uppercase text-sm mb-2">Best Value</h3>
        <p class="text-xs text-gray-700">Open-source leaders:</p>
        <div class="space-y-1 mt-1">
          <p class="text-xs text-gray-700"><span class="font-bold">Kimi K2.5</span> - 76.8%</p>
          <p class="text-xs text-gray-700"><span class="font-bold">GLM 4.7</span> - 73.8%</p>
          <p class="text-xs text-gray-700"><span class="font-bold">DeepSeek V3.2</span> - 73.1%</p>
        </div>
      </div>

      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <h3 class="font-bold text-gray-900 uppercase text-sm mb-2">About SWE-Bench</h3>
        <p class="text-xs text-gray-600 leading-relaxed">
          Benchmark evaluating models' ability to solve real software engineering problems from GitHub repositories. Higher scores indicate better performance on actual development tasks.
        </p>
      </div>
    </div>
  </div>

  <script>
    // Sorting functionality
    const sortButtons = document.querySelectorAll('.sort-btn');
    const tbody = document.getElementById('models-tbody');
    
    // Parse date string like "Jan 2026" to a number
    function parseDate(dateStr: string): number {
      const months: Record<string, number> = {
        'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'June': 5,
        'July': 6, 'Aug': 7, 'Sept': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11
      };
      const [month, year] = dateStr.split(' ');
      return parseInt(year) * 12 + (months[month] || 0);
    }
    
    sortButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const sortType = btn.getAttribute('data-sort');
        const sortOrder = btn.getAttribute('data-order');
        
        // Update button styles
        sortButtons.forEach(b => {
          b.classList.remove('bg-gray-900', 'text-white');
          b.classList.add('bg-gray-100', 'text-gray-600', 'border', 'border-gray-300');
        });
        btn.classList.remove('bg-gray-100', 'text-gray-600', 'border', 'border-gray-300');
        btn.classList.add('bg-gray-900', 'text-white');
        
        // Get all rows
        const rows = Array.from(tbody?.querySelectorAll('tr') || []);
        
        // Sort rows
        rows.sort((a, b) => {
          if (sortType === 'score') {
            const scoreA = parseFloat(a.getAttribute('data-score') || '0');
            const scoreB = parseFloat(b.getAttribute('data-score') || '0');
            return sortOrder === 'desc' ? scoreB - scoreA : scoreA - scoreB;
          } else {
            const dateA = parseInt(a.getAttribute('data-date') || '0');
            const dateB = parseInt(b.getAttribute('data-date') || '0');
            return sortOrder === 'desc' ? dateB - dateA : dateA - dateB;
          }
        });
        
        // Re-append rows in new order and update ranks
        rows.forEach((row, index) => {
          tbody?.appendChild(row);
          
          // Update rank display
          const rankEl = row.querySelector('.rank-number');
          if (rankEl) {
            rankEl.textContent = `#${index + 1}`;
          }
          
          // Update trophy icons
          const trophyEl = row.querySelector('td:first-child > div');
          if (trophyEl) {
            const existingTrophy = trophyEl.querySelector('svg');
            if (existingTrophy) {
              existingTrophy.remove();
            }
            if (index < 3) {
              const colors = ['text-yellow-500', 'text-gray-400', 'text-orange-400'];
              const trophy = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
              trophy.setAttribute('class', `w-4 h-4 ${colors[index]}`);
              trophy.setAttribute('viewBox', '0 0 24 24');
              trophy.setAttribute('fill', 'none');
              trophy.setAttribute('stroke', 'currentColor');
              trophy.setAttribute('stroke-width', '2');
              trophy.innerHTML = '<path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>';
              trophyEl.insertBefore(trophy, rankEl);
            }
          }
          
          // Update score color
          const scoreEl = row.querySelector('.score-display');
          if (scoreEl) {
            if (index < 3) {
              scoreEl.classList.remove('text-gray-700');
              scoreEl.classList.add('text-green-600');
            } else {
              scoreEl.classList.remove('text-green-600');
              scoreEl.classList.add('text-gray-700');
            }
          }
        });
      });
    });
  </script>
</MainLayout>
