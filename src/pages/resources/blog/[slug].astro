---
import MainLayout from '../../../layouts/MainLayout.astro';
import { getEntry } from 'astro:content';

const { slug } = Astro.params;
const post = await getEntry('blog', slug!);

if (!post) {
	return Astro.redirect('/resources');
}

const { Content } = await post.render();

function formatDate(date: Date) {
	return date.toLocaleDateString('fr-FR', {
		day: 'numeric',
		month: 'long',
		year: 'numeric'
	});
}
---

<MainLayout title={post.data.title}>
	<div class="page-enter max-w-3xl mx-auto">
		<a
			href="/resources"
			class="inline-flex items-center gap-1 text-xs font-bold text-gray-600 hover:text-primary-600 transition-colors mb-4"
		>
			<span class="w-2 h-2 bg-primary-500 rounded-full" />
			Retour aux resources
		</a>

		<article>
			<header class="mb-6">
				<div class="flex items-center gap-2 mb-3">
					{post.data.tags.map((tag) => (
						<span class="text-[10px] px-2 py-0.5 bg-primary-50 text-primary-700 rounded border border-primary-200 uppercase font-bold">
							{tag}
						</span>
					))}
				</div>
				<h1 class="font-bold text-xl text-gray-900 leading-tight">{post.data.title}</h1>
				<div class="flex items-center gap-3 mt-3 text-xs text-gray-600">
					<span class="font-medium">{post.data.author}</span>
					<span class="w-1 h-1 bg-gray-300 rounded-full" />
					<span>{formatDate(post.data.pubDate)}</span>
				</div>
			</header>

			{post.data.image && (
				<img
					src={post.data.image}
					alt={post.data.title}
					class="w-full h-48 object-cover rounded-lg border-2 border-gray-300 mb-6"
				/>
			)}

			<div class="prose prose-sm max-w-none prose-headings:font-bold prose-headings:text-gray-900 prose-a:text-primary-600 prose-a:no-underline hover:prose-a:underline prose-strong:text-gray-900 prose-strong:font-bold prose-code:bg-gray-100 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-primary-700 prose-code:font-mono prose-pre:bg-gray-900 prose-pre:text-gray-100">
				<Content />
			</div>
		</article>

		<div class="mt-8 pt-6 border-t-2 border-gray-200">
			<p class="text-sm text-gray-600">
				Vous avez aimé cet article ? Partagez-le avec vos collègues développeurs !
			</p>
		</div>
	</div>
</MainLayout>
